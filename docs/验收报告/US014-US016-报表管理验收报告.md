# US014/US015/US016 éªŒæ”¶æŠ¥å‘Š

> **åŠŸèƒ½åç§°**: æŠ¥è¡¨åˆ›å»º/ç¼–è¾‘/åˆ é™¤åŠŸèƒ½  
> **Story ID**: US014, US015, US016  
> **éªŒæ”¶æ—¥æœŸ**: 2026-01-21  
> **éªŒæ”¶äºº**: é¡¹ç›®ç»„  
> **éªŒæ”¶ç»“æœ**: âœ… é€šè¿‡

---

## ğŸ“‹ US014: æŠ¥è¡¨åˆ›å»ºåŠŸèƒ½

### æ•…äº‹æè¿°
**ä½œä¸º** æŠ¥è¡¨è®¾è®¡è€…  
**æˆ‘æƒ³è¦** åˆ›å»ºå®Œæ•´çš„æŠ¥è¡¨é…ç½®  
**ä»¥ä¾¿** ä¿å­˜æŠ¥è¡¨ä¾›ç”¨æˆ·ä½¿ç”¨

### éªŒæ”¶æ ‡å‡†æ£€æŸ¥

| éªŒæ”¶æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| 4æ­¥åˆ›å»ºæµç¨‹å®Œæ•´ | âœ… | Step1-4æ­¥éª¤å®Œæ•´å®ç° |
| æ­¥éª¤é—´æ•°æ®ä¼ é€’æ­£ç¡® | âœ… | formDataå“åº”å¼æ•°æ®å®ç°æ­¥éª¤é—´ä¼ é€’ |
| ä¿å­˜æˆåŠŸè·³è½¬åˆ°åˆ—è¡¨ | âœ… | ä¿å­˜åè‡ªåŠ¨å…³é—­å¯¹è¯æ¡†å¹¶åˆ·æ–°åˆ—è¡¨ |
| ä¿å­˜å¤±è´¥æ˜¾ç¤ºé”™è¯¯ | âœ… | try-catchæ•è·å¼‚å¸¸å¹¶æ˜¾ç¤ºElMessage |
| ä½¿ç”¨äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§ | âœ… | @Transactionalæ³¨è§£å®ç°äº‹åŠ¡ |

### ä»»åŠ¡å®Œæˆæƒ…å†µ

#### âœ… T014-1: å¤šæ­¥éª¤è¡¨å•æ•´åˆï¼ˆ1.5hï¼‰
- **å®ç°å†…å®¹**:
  - el-stepsç»„ä»¶å®ç°4æ­¥æµç¨‹
  - currentStepçŠ¶æ€ç®¡ç†å½“å‰æ­¥éª¤
  - v-showæ§åˆ¶æ­¥éª¤å†…å®¹æ˜¾ç¤º
  - ä¸Šä¸€æ­¥/ä¸‹ä¸€æ­¥æŒ‰é’®å¯¼èˆª
  
- **éªŒæ”¶è¯æ®**:
  ```vue
  <el-steps :active="currentStep" finish-status="success" align-center>
    <el-step title="åŸºæœ¬ä¿¡æ¯" />
    <el-step title="SQLç¼–è¾‘" />
    <el-step title="å‚æ•°é…ç½®" />
    <el-step title="åˆ—é…ç½®" />
  </el-steps>
  ```

#### âœ… T014-2: è¡¨å•æ•°æ®æ”¶é›†ä¸æäº¤ï¼ˆ1.5hï¼‰
- **å®ç°å†…å®¹**:
  - formDataå“åº”å¼å¯¹è±¡ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è¡¨å•æ•°æ®
  - Step1: æ”¶é›†name, description
  - Step2: æ”¶é›†sqlContent
  - Step3: æ”¶é›†paramsæ•°ç»„
  - Step4: æ”¶é›†columnsæ•°ç»„
  
- **éªŒæ”¶è¯æ®**:
  ```typescript
  const formData = ref<ReportFormData>({
    name: '',
    description: '',
    sqlContent: '',
    params: [],
    columns: []
  })
  ```

#### âœ… T014-3: ä¿å­˜æˆåŠŸè·³è½¬ï¼ˆ0.5hï¼‰
- **å®ç°å†…å®¹**:
  - POST /api/v1/reportsæ¥å£è°ƒç”¨
  - ElMessage.successæ˜¾ç¤ºæˆåŠŸæç¤º
  - dialogVisible = falseå…³é—­å¯¹è¯æ¡†
  - await loadReports()åˆ·æ–°åˆ—è¡¨
  
- **éªŒæ”¶è¯æ®**:
  ```typescript
  await axios.post('/api/v1/reports', formData.value)
  ElMessage.success('åˆ›å»ºæˆåŠŸ')
  dialogVisible.value = false
  await loadReports()
  ```

#### âœ… T014-4: æŠ¥è¡¨åˆ›å»ºAPIï¼ˆ3hï¼‰
- **å®ç°å†…å®¹**:
  - ReportController.createReport()æ¥å£
  - ReportService.createReport()ä¸šåŠ¡é€»è¾‘
  - Report/ReportParam/ReportColumnå®ä½“ç±»
  - ReportRepositoryç­‰Repositoryæ¥å£
  
- **éªŒæ”¶è¯æ®**:
  ```java
  @PostMapping
  public ResponseEntity<ReportDTO> createReport(@RequestBody ReportCreateRequest request) {
      ReportDTO report = reportService.createReport(request);
      return ResponseEntity.status(HttpStatus.CREATED).body(report);
  }
  ```

#### âœ… T014-5: äº‹åŠ¡å¤„ç†ï¼ˆ1.5hï¼‰
- **å®ç°å†…å®¹**:
  - @Transactionalæ³¨è§£åœ¨createReportæ–¹æ³•
  - æŠ¥è¡¨ä¿å­˜ã€å‚æ•°ä¿å­˜ã€åˆ—ä¿å­˜ä½¿ç”¨åŒä¸€äº‹åŠ¡
  - ä»»ä½•æ­¥éª¤å¤±è´¥è‡ªåŠ¨å›æ»š
  
- **éªŒæ”¶è¯æ®**:
  ```java
  @Transactional
  public ReportDTO createReport(ReportCreateRequest request) {
      report = reportRepository.save(report); // ä¿å­˜æŠ¥è¡¨
      reportParamRepository.save(param);      // ä¿å­˜å‚æ•°
      reportColumnRepository.save(column);    // ä¿å­˜åˆ—é…ç½®
      // ä»»ä½•å¼‚å¸¸éƒ½ä¼šå¯¼è‡´æ•´ä½“å›æ»š
  }
  ```

#### âœ… T014-6: æŠ¥è¡¨åˆ›å»ºE2Eæµ‹è¯•ï¼ˆ1.5hï¼‰
- **å®ç°å†…å®¹**:
  - åˆ›å»ºtest-reports.ps1æµ‹è¯•è„šæœ¬
  - æµ‹è¯•åˆ›å»ºæŠ¥è¡¨å®Œæ•´æµç¨‹
  - æµ‹è¯•æ•°æ®ä¼ é€’æ­£ç¡®æ€§
  - æµ‹è¯•äº‹åŠ¡ä¸€è‡´æ€§
  
- **éªŒæ”¶è¯æ®**: test-reports.ps1è„šæœ¬

---

## ğŸ“‹ US015: æŠ¥è¡¨ç¼–è¾‘åŠŸèƒ½

### æ•…äº‹æè¿°
**ä½œä¸º** æŠ¥è¡¨è®¾è®¡è€…  
**æˆ‘æƒ³è¦** ç¼–è¾‘å·²åˆ›å»ºçš„æŠ¥è¡¨  
**ä»¥ä¾¿** ä¿®æ”¹æŠ¥è¡¨é…ç½®

### éªŒæ”¶æ ‡å‡†æ£€æŸ¥

| éªŒæ”¶æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| å¯ä»¥æ‰“å¼€å·²æœ‰æŠ¥è¡¨ | âœ… | handleEditåŠ è½½æŠ¥è¡¨é…ç½® |
| æŠ¥è¡¨é…ç½®è‡ªåŠ¨åŠ è½½ | âœ… | GET /api/v1/reports/{id}/fullæ¥å£ |
| å¯ä»¥ä¿®æ”¹æ‰€æœ‰é…ç½® | âœ… | æ‰€æœ‰å­—æ®µå‡å¯ç¼–è¾‘ |
| ä¿å­˜æˆåŠŸæ›´æ–°æŠ¥è¡¨ | âœ… | PUT /api/v1/reports/{id}æ¥å£ |
| ä½¿ç”¨äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§ | âœ… | @Transactionalæ³¨è§£ |

### ä»»åŠ¡å®Œæˆæƒ…å†µ

#### âœ… T015-1: æŠ¥è¡¨é…ç½®åŠ è½½ï¼ˆ1hï¼‰
- **å®ç°å†…å®¹**:
  - handleEditå‡½æ•°å¤„ç†ç¼–è¾‘äº‹ä»¶
  - GET /api/v1/reports/{id}/fullåŠ è½½å®Œæ•´é…ç½®
  - åŒ…å«åŸºæœ¬ä¿¡æ¯ã€SQLã€å‚æ•°ã€åˆ—é…ç½®
  
- **éªŒæ”¶è¯æ®**:
  ```typescript
  const handleEdit = async (row: Report) => {
    const response = await axios.get(`/api/v1/reports/${row.id}/full`)
    formData.value = {
      name: response.data.name,
      description: response.data.description || '',
      sqlContent: response.data.sqlContent,
      params: response.data.params || [],
      columns: response.data.columns || []
    }
  }
  ```

#### âœ… T015-2: è¡¨å•é¢„å¡«å……ï¼ˆ1hï¼‰
- **å®ç°å†…å®¹**:
  - formData.valueèµ‹å€¼å®ç°æ‰€æœ‰æ­¥éª¤è‡ªåŠ¨é¢„å¡«å……
  - Step1: name, descriptionè‡ªåŠ¨å¡«å……
  - Step2: SqlEditor v-modelè‡ªåŠ¨å¡«å……
  - Step3: paramsè¡¨æ ¼è‡ªåŠ¨å¡«å……
  - Step4: columnsè¡¨æ ¼è‡ªåŠ¨å¡«å……
  
- **éªŒæ”¶è¯æ®**: formDataå“åº”å¼æ•°æ®ç»‘å®š

#### âœ… T015-3: æ›´æ–°æäº¤ï¼ˆ0.5hï¼‰
- **å®ç°å†…å®¹**:
  - isEditå’ŒcurrentEditIdæ ‡è¯†ç¼–è¾‘æ¨¡å¼
  - PUT /api/v1/reports/{id}æ¥å£è°ƒç”¨
  - æ›´æ–°æˆåŠŸæ˜¾ç¤ºæç¤ºå¹¶åˆ·æ–°åˆ—è¡¨
  
- **éªŒæ”¶è¯æ®**:
  ```typescript
  if (isEdit.value && currentEditId.value) {
    await axios.put(`/api/v1/reports/${currentEditId.value}`, formData.value)
    ElMessage.success('æ›´æ–°æˆåŠŸ')
  }
  ```

#### âœ… T015-4: æŠ¥è¡¨é…ç½®æŸ¥è¯¢APIï¼ˆ1.5hï¼‰
- **å®ç°å†…å®¹**:
  - GET /api/v1/reports/{id}/fullæ¥å£
  - ReportService.getReportById()æ–¹æ³•
  - å…³è”æŸ¥è¯¢paramså’Œcolumns
  - è¿”å›å®Œæ•´ReportDTOå¯¹è±¡
  
- **éªŒæ”¶è¯æ®**:
  ```java
  @GetMapping("/{id}/full")
  public ResponseEntity<ReportDTO> getReportFull(@PathVariable Long id) {
      ReportDTO report = reportService.getReportById(id);
      return ResponseEntity.ok(report);
  }
  ```

#### âœ… T015-5: æŠ¥è¡¨æ›´æ–°APIï¼ˆ1.5hï¼‰
- **å®ç°å†…å®¹**:
  - PUT /api/v1/reports/{id}æ¥å£
  - ReportService.updateReport()æ–¹æ³•
  - å…ˆåˆ é™¤æ—§å‚æ•°/åˆ—ï¼Œå†æ’å…¥æ–°é…ç½®
  - ä½¿ç”¨@Transactionalä¿è¯ä¸€è‡´æ€§
  
- **éªŒæ”¶è¯æ®**:
  ```java
  @Transactional
  public ReportDTO updateReport(Long id, ReportCreateRequest request) {
      report.setName(request.getName());
      reportParamRepository.deleteByReportId(id);
      // ä¿å­˜æ–°å‚æ•°
      reportColumnRepository.deleteByReportId(id);
      // ä¿å­˜æ–°åˆ—é…ç½®
  }
  ```

#### âœ… T015-6: æŠ¥è¡¨ç¼–è¾‘æµ‹è¯•ï¼ˆ1hï¼‰
- **å®ç°å†…å®¹**: åŒ…å«åœ¨test-reports.ps1ä¸­
- **æµ‹è¯•ç”¨ä¾‹**: åˆ›å»ºåç¼–è¾‘éªŒè¯

---

## ğŸ“‹ US016: æŠ¥è¡¨åˆ é™¤åŠŸèƒ½

### æ•…äº‹æè¿°
**ä½œä¸º** æŠ¥è¡¨è®¾è®¡è€…  
**æˆ‘æƒ³è¦** åˆ é™¤ä¸éœ€è¦çš„æŠ¥è¡¨  
**ä»¥ä¾¿** æ¸…ç†æŠ¥è¡¨åˆ—è¡¨

### éªŒæ”¶æ ‡å‡†æ£€æŸ¥

| éªŒæ”¶æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| åˆ é™¤å‰æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡† | âœ… | ElMessageBox.confirmå®ç° |
| åˆ é™¤æˆåŠŸç§»é™¤æŠ¥è¡¨ | âœ… | DELETEæ¥å£è°ƒç”¨æˆåŠŸ |
| çº§è”åˆ é™¤å‚æ•°å’Œåˆ—é…ç½® | âœ… | æ•°æ®åº“ON DELETE CASCADE |
| åˆ é™¤æˆåŠŸåˆ·æ–°åˆ—è¡¨ | âœ… | await loadReports()åˆ·æ–° |
| åˆ é™¤å¤±è´¥æ˜¾ç¤ºé”™è¯¯ | âœ… | catchæ•è·å¼‚å¸¸æ˜¾ç¤ºElMessage |

### ä»»åŠ¡å®Œæˆæƒ…å†µ

#### âœ… T016-1: åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†ï¼ˆ0.5hï¼‰
- **å®ç°å†…å®¹**:
  - ElMessageBox.confirmæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
  - æ˜¾ç¤ºæŠ¥è¡¨åç§°
  - çº¢è‰²ç¡®è®¤æŒ‰é’®ï¼ˆconfirmButtonClass: 'el-button--danger'ï¼‰
  - è­¦å‘Šç±»å‹ï¼ˆtype: 'warning'ï¼‰
  
- **éªŒæ”¶è¯æ®**:
  ```typescript
  await ElMessageBox.confirm(
    `ç¡®å®šè¦åˆ é™¤æŠ¥è¡¨"${row.name}"å—ï¼Ÿåˆ é™¤åå°†æ— æ³•æ¢å¤ã€‚`,
    'åˆ é™¤ç¡®è®¤',
    {
      confirmButtonText: 'ç¡®å®šåˆ é™¤',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning',
      confirmButtonClass: 'el-button--danger'
    }
  )
  ```

#### âœ… T016-2: åˆ é™¤APIè°ƒç”¨ï¼ˆ0.5hï¼‰
- **å®ç°å†…å®¹**:
  - handleDeleteå‡½æ•°å¤„ç†åˆ é™¤äº‹ä»¶
  - DELETE /api/v1/reports/{id}æ¥å£è°ƒç”¨
  - åˆ é™¤æˆåŠŸæ˜¾ç¤ºæç¤ºå¹¶åˆ·æ–°åˆ—è¡¨
  - ç”¨æˆ·å–æ¶ˆæ—¶å¿½ç•¥é”™è¯¯
  
- **éªŒæ”¶è¯æ®**:
  ```typescript
  await axios.delete(`/api/v1/reports/${row.id}`)
  ElMessage.success('åˆ é™¤æˆåŠŸ')
  await loadReports()
  ```

#### âœ… T016-3: æŠ¥è¡¨åˆ é™¤APIï¼ˆ1.5hï¼‰
- **å®ç°å†…å®¹**:
  - DELETE /api/v1/reports/{id}æ¥å£
  - ReportService.deleteReport()æ–¹æ³•
  - ä½¿ç”¨@Transactionalä¿è¯ä¸€è‡´æ€§
  - æ•°æ®åº“çº§è”åˆ é™¤å‚æ•°å’Œåˆ—é…ç½®
  
- **éªŒæ”¶è¯æ®**:
  ```java
  @DeleteMapping("/{id}")
  public ResponseEntity<Void> deleteReport(@PathVariable Long id) {
      reportService.deleteReport(id);
      return ResponseEntity.noContent().build();
  }
  
  @Transactional
  public void deleteReport(Long id) {
      reportRepository.deleteById(id);
      // ON DELETE CASCADEè‡ªåŠ¨åˆ é™¤å‚æ•°å’Œåˆ—
  }
  ```

#### âœ… T016-4: æŠ¥è¡¨åˆ é™¤æµ‹è¯•ï¼ˆ1hï¼‰
- **å®ç°å†…å®¹**: åŒ…å«åœ¨test-reports.ps1ä¸­
- **æµ‹è¯•ç”¨ä¾‹**: åˆ é™¤æŠ¥è¡¨å¹¶éªŒè¯åˆ—è¡¨æ›´æ–°

---

## ğŸ“Š æ•´ä½“éªŒæ”¶æ€»ç»“

### åŠŸèƒ½å®Œæˆåº¦

| Story | ä»»åŠ¡æ•° | å®Œæˆæ•° | å®Œæˆç‡ |
|-------|--------|--------|--------|
| US014 | 6 | 6 | 100% |
| US015 | 6 | 6 | 100% |
| US016 | 4 | 4 | 100% |
| **æ€»è®¡** | **16** | **16** | **100%** |

### ä»£ç è´¨é‡è¯„ä¼°

#### åç«¯ä»£ç 
- âœ… **å®ä½“ç±»**: Report, ReportParam, ReportColumnå®Œæ•´å®ç°
- âœ… **Repository**: 3ä¸ªRepositoryæ¥å£ï¼Œæ”¯æŒåŸºæœ¬CRUD
- âœ… **Service**: ReportServiceå®Œæ•´ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨@Transactional
- âœ… **Controller**: ReportControlleræä¾›RESTful API
- âœ… **DTO**: ReportDTO, ReportCreateRequestç­‰ä¼ è¾“å¯¹è±¡
- âœ… **å¼‚å¸¸å¤„ç†**: BusinessExceptionç»Ÿä¸€å¼‚å¸¸å¤„ç†

#### å‰ç«¯ä»£ç 
- âœ… **ç»„ä»¶**: Reports.vueå®Œæ•´å®ç°æŠ¥è¡¨ç®¡ç†ç•Œé¢
- âœ… **çŠ¶æ€ç®¡ç†**: refå“åº”å¼æ•°æ®ç®¡ç†
- âœ… **UIç»„ä»¶**: Element Plus el-table, el-dialog, el-stepsç­‰
- âœ… **SQLç¼–è¾‘å™¨**: é›†æˆSqlEditorç»„ä»¶
- âœ… **é”™è¯¯å¤„ç†**: try-catch + ElMessageç»Ÿä¸€å¤„ç†

### æŠ€æœ¯äº®ç‚¹

1. **äº‹åŠ¡ä¸€è‡´æ€§**: ä½¿ç”¨Spring @Transactionalç¡®ä¿æ•°æ®ä¸€è‡´æ€§
2. **çº§è”åˆ é™¤**: æ•°æ®åº“ON DELETE CASCADEç®€åŒ–åˆ é™¤é€»è¾‘
3. **æ­¥éª¤å¼è¡¨å•**: 4æ­¥åˆ›å»ºæµç¨‹æå‡ç”¨æˆ·ä½“éªŒ
4. **å“åº”å¼æ•°æ®**: Vue3 refå®ç°æ­¥éª¤é—´æ•°æ®ä¼ é€’
5. **RESTful API**: æ ‡å‡†HTTPæ–¹æ³•è®¾è®¡APIæ¥å£
6. **ç±»å‹å®‰å…¨**: TypeScriptæ¥å£å®šä¹‰ç¡®ä¿ç±»å‹å®‰å…¨

### æµ‹è¯•è¦†ç›–

- âœ… åˆ›å»ºæŠ¥è¡¨æµç¨‹æµ‹è¯•
- âœ… ç¼–è¾‘æŠ¥è¡¨æµç¨‹æµ‹è¯•
- âœ… åˆ é™¤æŠ¥è¡¨æµç¨‹æµ‹è¯•
- âœ… æ•°æ®éªŒè¯æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•

---

## ğŸ¯ éªŒæ”¶ç»“è®º

### éªŒæ”¶ç»“æœ: âœ… **é€šè¿‡**

### ç†ç”±:
1. æ‰€æœ‰éªŒæ”¶æ ‡å‡†100%æ»¡è¶³
2. 16ä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆ
3. å‰åç«¯ä»£ç è´¨é‡è‰¯å¥½
4. åŠŸèƒ½å®Œæ•´ä¸”æ˜“ç”¨
5. æŠ€æœ¯å®ç°è§„èŒƒ

### å»ºè®®:
1. âœ… å·²å®Œæˆ: å‰åç«¯é›†æˆæµ‹è¯•
2. â­ï¸ å¾…ä¼˜åŒ–: æ·»åŠ å•å…ƒæµ‹è¯•æå‡è¦†ç›–ç‡
3. â­ï¸ å¾…ä¼˜åŒ–: æ·»åŠ å‚æ•°/åˆ—é…ç½®çš„è¯¦ç»†éªŒè¯
4. â­ï¸ å¾…ä¼˜åŒ–: SQLè¯­æ³•éªŒè¯åŠŸèƒ½

---

**éªŒæ”¶ç­¾å­—**:  
éªŒæ”¶äºº: é¡¹ç›®ç»„  
éªŒæ”¶æ—¥æœŸ: 2026-01-21  
ç­¾å­—: ________________

