# ç¨‹åºå‘˜æŠ¥è¡¨ç”Ÿæˆå·¥å…· - MVPé¡¹ç›®åˆ†ææŠ¥å‘Š

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-26
> **åˆ†ææ–¹æ³•**: Sequential Thinking ç³»ç»Ÿåˆ†æ
> **é¡¹ç›®å‘¨æœŸ**: 2å‘¨MVP
> **å›¢é˜Ÿè§„æ¨¡**: 2åå¼€å‘äººå‘˜

---

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. åŠŸèƒ½æ¨¡å—æ‹†è§£](#2-åŠŸèƒ½æ¨¡å—æ‹†è§£)
- [3. æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ](#3-æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ)
- [4. æŠ€æœ¯æ¶æ„è®¾è®¡](#4-æŠ€æœ¯æ¶æ„è®¾è®¡)
- [5. æ•°æ®åº“è®¾è®¡](#5-æ•°æ®åº“è®¾è®¡)
- [6. æ•°æ®éœ€æ±‚åˆ†æ](#6-æ•°æ®éœ€æ±‚åˆ†æ)
- [7. å®æ–½é£é™©è¯„ä¼°](#7-å®æ–½é£é™©è¯„ä¼°)
- [8. MVPèŒƒå›´ä¸æ’æœŸ](#8-mvpèŒƒå›´ä¸æ’æœŸ)
- [9. éªŒæ”¶æ ‡å‡†](#9-éªŒæ”¶æ ‡å‡†)
- [10. ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®](#10-ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®)
- [11. é™„å½•](#11-é™„å½•)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 éœ€æ±‚èƒŒæ™¯

å¼€å‘ä¸€ä¸ªé¢å‘ç¨‹åºå‘˜çš„æŠ¥è¡¨ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒåŒç«¯æ¶æ„ï¼ˆè®¾è®¡ç«¯ + å®¢æˆ·ç«¯ï¼‰ï¼Œæ ¸å¿ƒä»·å€¼æ˜¯è®©å¼€å‘äººå‘˜èƒ½å¤Ÿå¿«é€Ÿåˆ›å»ºã€åˆ†äº«å’Œç®¡ç†SQLæŸ¥è¯¢æŠ¥è¡¨ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

1. **SQLæŸ¥è¯¢ç®¡ç†**: è¾“å…¥SQLè¯­å¥ï¼Œæ”¯æŒå‚æ•°åŒ–æŸ¥è¯¢
2. **æŠ¥è¡¨æ¨¡æ¿è®¾è®¡**: å¯è§†åŒ–é…ç½®æŠ¥è¡¨åˆ—å±æ€§ï¼ˆå­—æ®µåã€æ˜¾ç¤ºåç§°ã€åˆ—å®½ã€æ ¼å¼åŒ–ï¼‰
3. **æŠ¥è¡¨é¢„è§ˆï¼ˆè®¾è®¡ç«¯ï¼‰**: è®¾è®¡é˜¶æ®µçš„æµ‹è¯•æ‰§è¡Œï¼ŒéªŒè¯SQLå’Œå‚æ•°é…ç½®çš„æ­£ç¡®æ€§
4. **æŠ¥è¡¨æŸ¥è¯¢ï¼ˆç”¨æˆ·ç«¯ï¼‰**: æ™®é€šç”¨æˆ·æŸ¥çœ‹æˆæƒæŠ¥è¡¨ã€è¾“å…¥å‚æ•°ã€æ‰§è¡ŒæŸ¥è¯¢
5. **Excelå¯¼å‡º**: å°†æŸ¥è¯¢ç»“æœå¯¼å‡ºä¸ºExcelæ–‡ä»¶
6. **åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰**: é€šè¿‡è§’è‰²æ§åˆ¶æŠ¥è¡¨è®¿é—®æƒé™
7. **ä¸‰ç«¯æ¶æ„**:
   - **ç®¡ç†ç«¯ï¼ˆAdminï¼‰**: ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€å…¨å±€è®¾ç½®
   - **è®¾è®¡ç«¯ï¼ˆDesignerï¼‰**: åˆ›å»ºå’Œé…ç½®æŠ¥è¡¨ã€åˆ†é…æŠ¥è¡¨æƒé™ã€**æŠ¥è¡¨é¢„è§ˆ**
   - **ç”¨æˆ·ç«¯ï¼ˆViewerï¼‰**: **æŠ¥è¡¨æŸ¥è¯¢**ï¼ˆæŸ¥çœ‹æˆæƒæŠ¥è¡¨ã€æ‰§è¡ŒæŸ¥è¯¢ï¼‰ã€Excelå¯¼å‡º

### 1.3 çº¦æŸæ¡ä»¶

#### äººå‘˜çº¦æŸ

- å¼€å‘å›¢é˜Ÿ: **2åå¼€å‘äººå‘˜**
- æŠ€èƒ½è¦æ±‚: ç†Ÿæ‚‰SpringBootå’ŒVueæ¡†æ¶
- æ— ä¸“èŒç®—æ³•å·¥ç¨‹å¸ˆï¼ˆä¸éœ€è¦å¤æ‚ç®—æ³•ï¼‰

#### æŠ€æœ¯çº¦æŸ

- **åç«¯**: SpringBoot
- **å‰ç«¯**: Vue.js
- **æ•°æ®åº“**: MySQL 5.7+
- **éƒ¨ç½²**: å•æœºéƒ¨ç½²ï¼ˆMVPé˜¶æ®µï¼‰

#### æ—¶é—´çº¦æŸ

- **MVPäº¤ä»˜æ—¶é—´**: 2å‘¨ï¼ˆ10ä¸ªå·¥ä½œæ—¥ï¼‰
- **å·¥ä½œé‡**: 2äºº Ã— 10å¤© = 20äººæ—¥
- **é¢„ä¼°**: æ ¸å¿ƒåŠŸèƒ½16äººæ—¥ + 4äººæ—¥Bufferï¼ˆ20%ä½™é‡ï¼‰

### 1.4 é¡¹ç›®å®šä½

è¿™æ˜¯ä¸€ä¸ª**ä½ä»£ç æŠ¥è¡¨å¹³å°**çš„ç®€åŒ–ç‰ˆï¼Œç±»ä¼¼å¸†è½¯ã€æ¶¦ä¹¾ç­‰å•†ä¸šæŠ¥è¡¨å·¥å…·çš„æ ¸å¿ƒåŠŸèƒ½å­é›†ï¼Œèšç„¦åœ¨ï¼š

- âœ… å¿«é€ŸæŸ¥è¯¢ä¸å±•ç¤º
- âœ… åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰
- âœ… Excelå¯¼å‡º
- âœ… ä¸‰ç«¯åˆ†ç¦»æ¶æ„ï¼ˆç®¡ç†ç«¯/è®¾è®¡ç«¯/ç”¨æˆ·ç«¯ï¼‰
- âŒ ä¸åŒ…å«å¤æ‚å›¾è¡¨
- âŒ ä¸åŒ…å«æŠ¥è¡¨è®¾è®¡å™¨æ‹–æ‹½
- âŒ ä¸åŒ…å«ç»„ç»‡æ¶æ„æ ‘å½¢æƒé™

### 1.5 æ€»ä½“ç›®æ ‡


Specificï¼ˆå…·ä½“çš„ï¼‰: å¼€å‘ä¸€ä¸ªé¢å‘ç¨‹åºå‘˜çš„æŠ¥è¡¨ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒä¸‰ç«¯æ¶æ„ï¼ˆç®¡ç†ç«¯ã€è®¾è®¡ç«¯ã€ç”¨æˆ·ç«¯ï¼‰ï¼Œå®ç°SQLæŸ¥è¯¢ç®¡ç†ã€**æŠ¥è¡¨é¢„è§ˆï¼ˆè®¾è®¡ç«¯ï¼‰**ã€**æŠ¥è¡¨æŸ¥è¯¢ï¼ˆç”¨æˆ·ç«¯ï¼‰**ã€Excelå¯¼å‡ºå’ŒåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰ã€‚

Measurableï¼ˆå¯è¡¡é‡çš„ï¼‰:

å®Œæˆæ ¸å¿ƒåŠŸèƒ½16äººæ—¥çš„å¼€å‘ä»»åŠ¡
é€šè¿‡æ‰€æœ‰P0çº§åˆ«åŠŸèƒ½éªŒæ”¶ï¼ˆç®¡ç†ç«¯ã€è®¾è®¡ç«¯ã€ç”¨æˆ·ç«¯å…±40é¡¹éªŒæ”¶ç‚¹ï¼‰
æ€§èƒ½æŒ‡æ ‡ï¼š1000è¡Œæ•°æ®æŸ¥è¯¢<3ç§’ï¼ŒExcelå¯¼å‡º<5ç§’ï¼ŒæŠ¥è¡¨åˆ—è¡¨åŠ è½½<1ç§’
æ— P0çº§åˆ«Bugï¼ˆæ•°æ®ä¸¢å¤±ã€ç³»ç»Ÿå´©æºƒã€SQLæ³¨å…¥ï¼‰
Achievableï¼ˆå¯å®ç°çš„ï¼‰:

å›¢é˜Ÿè§„æ¨¡ï¼š2åå¼€å‘äººå‘˜ï¼ˆç†Ÿæ‚‰SpringBootå’ŒVueæ¡†æ¶ï¼‰
æŠ€æœ¯æ ˆæˆç†Ÿï¼šSpringBoot + Vue.js + MySQL 5.7+
èŒƒå›´æ§åˆ¶ï¼šMVPç‰ˆæœ¬ï¼Œä¸åŒ…å«å¤æ‚å›¾è¡¨ã€æ‹–æ‹½è®¾è®¡å™¨ã€ç»„ç»‡æ¶æ„æ ‘å½¢æƒé™
Relevantï¼ˆç›¸å…³çš„ï¼‰:

è§£å†³å¼€å‘äººå‘˜å¿«é€Ÿåˆ›å»ºã€åˆ†äº«å’Œç®¡ç†SQLæŸ¥è¯¢æŠ¥è¡¨çš„éœ€æ±‚
æä¾›ä½ä»£ç æŠ¥è¡¨å¹³å°çš„æ ¸å¿ƒåŠŸèƒ½å­é›†
æ”¯æŒå¤šè§’è‰²åä½œï¼ˆç®¡ç†å‘˜ã€è®¾è®¡è€…ã€æ™®é€šç”¨æˆ·ï¼‰
Time-boundï¼ˆæœ‰æ—¶é—´é™åˆ¶çš„ï¼‰:

MVPäº¤ä»˜æ—¶é—´ï¼š2å‘¨ï¼ˆ10ä¸ªå·¥ä½œæ—¥ï¼‰
æ€»å·¥ä½œé‡ï¼š20äººæ—¥ï¼ˆ16äººæ—¥æ ¸å¿ƒåŠŸèƒ½ + 4äººæ—¥Bufferï¼‰

---

## 2. åŠŸèƒ½æ¨¡å—æ‹†è§£

### 2.1 æ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPå¿…é¡»ï¼‰

#### 2.1.1 SQLæŸ¥è¯¢ç®¡ç† â­

**åŠŸèƒ½æè¿°**:

- è¾“å…¥SQLæŸ¥è¯¢è¯­å¥ï¼ˆä»…æ”¯æŒSELECTï¼‰
- å®šä¹‰æŸ¥è¯¢å‚æ•°ï¼ˆå‚æ•°åã€ç±»å‹ã€é»˜è®¤å€¼ã€æ˜¯å¦å¿…å¡«ï¼‰
- æ”¯æŒå‚æ•°å ä½ç¬¦æ ¼å¼: `#{paramName}`
- æµ‹è¯•æ‰§è¡ŒæŸ¥è¯¢ï¼Œé¢„è§ˆç»“æœ

**æŠ€æœ¯è¦ç‚¹**:

- SQLå®‰å…¨æ ¡éªŒï¼ˆé˜²æ­¢æ³¨å…¥ï¼‰
- PreparedStatementå‚æ•°åŒ–
- æŸ¥è¯¢è¶…æ—¶æ§åˆ¶ï¼ˆ5ç§’ï¼‰

**ä¼˜å…ˆçº§**: P0ï¼ˆæ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼‰

---

#### 2.1.2 æŠ¥è¡¨æ¨¡æ¿è®¾è®¡ â­

**åŠŸèƒ½æè¿°**:

- åŸºäºæŸ¥è¯¢ç»“æœé…ç½®åˆ—å±æ€§
  - å­—æ®µåï¼ˆæ¥è‡ªSQLç»“æœé›†ï¼‰
  - æ˜¾ç¤ºåç§°ï¼ˆè‡ªå®šä¹‰ï¼‰
  - åˆ—å®½ï¼ˆåƒç´ ï¼‰
  - æ•°æ®æ ¼å¼åŒ–ï¼ˆæ—¥æœŸ/æ•°å­—/è´§å¸ï¼‰
- æŠ¥è¡¨å…ƒä¿¡æ¯ï¼ˆåç§°ã€æè¿°ã€åˆ›å»ºäººï¼‰

**æŠ€æœ¯è¦ç‚¹**:

- åŠ¨æ€åˆ—æå–ï¼ˆä»ResultSetå…ƒæ•°æ®ï¼‰
- åˆ—é…ç½®æŒä¹…åŒ–ï¼ˆJSONæˆ–å…³è”è¡¨ï¼‰

**ä¼˜å…ˆçº§**: P0

---

#### 2.1.3 æŠ¥è¡¨é¢„è§ˆï¼ˆè®¾è®¡ç«¯ï¼‰â­

**åŠŸèƒ½æè¿°**:

- **æ‰€å±ç«¯**: è®¾è®¡ç«¯ï¼ˆDesignerï¼‰
- **ä½¿ç”¨åœºæ™¯**: æŠ¥è¡¨è®¾è®¡é˜¶æ®µçš„æµ‹è¯•éªŒè¯
- å‰ç«¯è¡¨æ ¼å±•ç¤ºæŸ¥è¯¢ç»“æœ
- åˆ†é¡µæ˜¾ç¤ºï¼ˆæ¯é¡µ100æ¡ï¼‰
- æŒ‰åˆ—æ’åº
- å®æ—¶å‚æ•°è¾“å…¥
- æ”¯æŒå¤šæ¬¡è°ƒè¯•æ‰§è¡Œï¼ŒéªŒè¯SQLæ­£ç¡®æ€§

**æŠ€æœ¯è¦ç‚¹**:

- Vue + Element Tableç»„ä»¶
- åŠ¨æ€åˆ—æ¸²æŸ“
- å‰ç«¯åˆ†é¡µ
- è®¾è®¡ç«¯ç‹¬äº«åŠŸèƒ½ï¼ˆADMINå’ŒDESIGNERè§’è‰²å¯ç”¨ï¼‰

**ä¼˜å…ˆçº§**: P0

---

#### 2.1.4 æŠ¥è¡¨æŸ¥è¯¢ï¼ˆç”¨æˆ·ç«¯ï¼‰â­

**åŠŸèƒ½æè¿°**:

- **æ‰€å±ç«¯**: ç”¨æˆ·ç«¯ï¼ˆViewerï¼‰
- **ä½¿ç”¨åœºæ™¯**: æ™®é€šç”¨æˆ·æŸ¥è¯¢å·²æˆæƒçš„æŠ¥è¡¨æ•°æ®
- æŸ¥çœ‹æˆæƒæŠ¥è¡¨åˆ—è¡¨
- é€‰æ‹©ç‰¹å®šæŠ¥è¡¨è¿›å…¥æŸ¥è¯¢é¡µé¢
- è¾“å…¥æŸ¥è¯¢å‚æ•°
- æ‰§è¡ŒæŸ¥è¯¢å¹¶å±•ç¤ºç»“æœ
- åˆ†é¡µæ˜¾ç¤ºï¼ˆæ¯é¡µ100æ¡ï¼‰
- æŒ‰åˆ—æ’åº

**æŠ€æœ¯è¦ç‚¹**:

- æƒé™è¿‡æ»¤ï¼šä»…æ˜¾ç¤ºå·²æˆæƒæŠ¥è¡¨
- å‚æ•°è¡¨å•è‡ªåŠ¨ç”Ÿæˆï¼ˆåŸºäºæŠ¥è¡¨å‚æ•°å®šä¹‰ï¼‰
- åŠ¨æ€åˆ—æ¸²æŸ“
- å‰ç«¯åˆ†é¡µå’Œæ’åº

**ä¼˜å…ˆçº§**: P0

---

#### 2.1.5 Excelå¯¼å‡º â­

**åŠŸèƒ½æè¿°**:

- **æ‰€å±ç«¯**: ç”¨æˆ·ç«¯ï¼ˆViewerï¼‰
- å¯¼å‡ºæŸ¥è¯¢ç»“æœä¸ºExcelæ–‡ä»¶ï¼ˆ.xlsxï¼‰
- æ–‡ä»¶å‘½å: `æŠ¥è¡¨å_YYYYMMDD.xlsx`
- åŒ…å«è¡¨å¤´ï¼ˆæ˜¾ç¤ºåç§°ï¼‰å’Œæ•°æ®è¡Œ
- é™åˆ¶å¯¼å‡ºè¡Œæ•°: **æœ€å¤š5000è¡Œ**

**æŠ€æœ¯è¦ç‚¹**:

- Apache POIï¼ˆXSSFWorkbookï¼‰
- è¶…è¿‡5000è¡Œæ—¶æç¤ºç”¨æˆ·æ·»åŠ ç­›é€‰æ¡ä»¶
- åç«¯ç”Ÿæˆæ–‡ä»¶æµï¼Œå‰ç«¯ä¸‹è½½
- **ä¾èµ–æŠ¥è¡¨æŸ¥è¯¢åŠŸèƒ½**ï¼Œåªèƒ½å¯¼å‡ºå·²æŸ¥è¯¢å‡ºçš„æ•°æ®

**ä¼˜å…ˆçº§**: P0

---

#### 2.1.6 åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰ â­

**åŠŸèƒ½æè¿°**:

- **è§’è‰²å®šä¹‰**: ç®¡ç†å‘˜ï¼ˆADMINï¼‰ã€è®¾è®¡è€…ï¼ˆDESIGNERï¼‰ã€æ™®é€šç”¨æˆ·ï¼ˆVIEWERï¼‰
- **è§’è‰²-æŠ¥è¡¨å…³è”**: è®¾è®¡ç«¯åˆ†é…æŠ¥è¡¨æƒé™ç»™è§’è‰²ï¼ˆè€Œéå•ä¸ªç”¨æˆ·ï¼‰
- **ç”¨æˆ·-è§’è‰²å…³è”**: ç®¡ç†ç«¯ä¸ºç”¨æˆ·åˆ†é…è§’è‰²
- **æƒé™ç»§æ‰¿**: ADMIN > DESIGNER > VIEWERï¼ˆç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰æŠ¥è¡¨ï¼‰
- **è®¿é—®æ§åˆ¶**: æ‹¦æˆªå™¨æ ¡éªŒç”¨æˆ·è§’è‰²ä¸æŠ¥è¡¨æƒé™

**è§’è‰²æƒé™çŸ©é˜µ**:

| è§’è‰²     | ç®¡ç†ç«¯åŠŸèƒ½ | è®¾è®¡ç«¯åŠŸèƒ½        | ç”¨æˆ·ç«¯åŠŸèƒ½      |
| -------- | ---------- | ----------------- | --------------- |
| ADMIN    | âœ… å…¨éƒ¨    | âœ… å…¨éƒ¨ï¼ˆå«æŠ¥è¡¨é¢„è§ˆï¼‰           | âœ… å…¨éƒ¨ï¼ˆå«æŠ¥è¡¨æŸ¥è¯¢ï¼‰ |
| DESIGNER | âŒ æ—       | âœ… åˆ›å»º/ç¼–è¾‘/æˆæƒ/é¢„è§ˆ | âœ… æŸ¥çœ‹æˆæƒæŠ¥è¡¨ï¼ˆæŠ¥è¡¨æŸ¥è¯¢ï¼‰ |
| VIEWER   | âŒ æ—       | âŒ æ—              | âœ… æŸ¥çœ‹æˆæƒæŠ¥è¡¨ï¼ˆæŠ¥è¡¨æŸ¥è¯¢ï¼‰ |

**åŠŸèƒ½åˆ†å¸ƒè¯´æ˜**:

- **ç®¡ç†ç«¯ï¼ˆAdminï¼‰**: ç”¨æˆ·ç®¡ç†ã€è§’è‰²åˆ†é…ã€æƒé™æ§åˆ¶
- **è®¾è®¡ç«¯ï¼ˆDesignerï¼‰**: SQLç¼–å†™ã€æŠ¥è¡¨æ¨¡æ¿è®¾è®¡ã€å‚æ•°é…ç½®ã€**æŠ¥è¡¨é¢„è§ˆ**ï¼ˆæµ‹è¯•æ‰§è¡Œï¼‰ã€æƒé™æˆæƒ
- **ç”¨æˆ·ç«¯ï¼ˆViewerï¼‰**: **æŠ¥è¡¨æŸ¥è¯¢**ï¼ˆæŸ¥çœ‹æˆæƒæŠ¥è¡¨ã€è¾“å…¥å‚æ•°ã€æ‰§è¡ŒæŸ¥è¯¢ï¼‰ã€Excelå¯¼å‡º

**æŠ€æœ¯è¦ç‚¹**:

- ç®€åŒ–RBACæ¨¡å‹ï¼ˆä¸‰ä¸ªå›ºå®šè§’è‰²ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰è§’è‰²ï¼‰
- è§’è‰²-æŠ¥è¡¨å¤šå¯¹å¤šå…³è”
- æ‹¦æˆªå™¨æ ¡éªŒç”¨æˆ·è§’è‰²æƒé™
- Sessionæˆ–Tokenè®¤è¯

**ä¼˜å…ˆçº§**: P0

---

### 2.2 å¯å»¶æœŸåŠŸèƒ½ï¼ˆV2ç‰ˆæœ¬ï¼‰

#### 2.2.1 é«˜çº§åˆ†ç»„æƒé™ï¼ˆV2ï¼‰

**å»¶æœŸç†ç”±**: å¤æ‚æƒé™æ¨¡å‹å¼€å‘+æµ‹è¯•éœ€è¦5äººæ—¥ï¼ŒMVPæ—¶é—´ä¸è¶³

**åŠŸèƒ½æè¿°**:

- è§’è‰²ç®¡ç†ï¼ˆç®¡ç†å‘˜/è®¾è®¡è€…/æ™®é€šç”¨æˆ·ï¼‰
- ç»„ç»‡æ¶æ„æ ‘
- è§’è‰²ç»§æ‰¿ä¸æƒé™èšåˆ

**é¢„ä¼°å·¥ä½œé‡**: 8äººæ—¥

---

#### 2.2.2 æŠ¥è¡¨æ ·å¼ç¾åŒ–ï¼ˆV2ï¼‰

**å»¶æœŸç†ç”±**: MVPé‡åŠŸèƒ½è½»ç¾è§‚ï¼Œç”¨æˆ·ä½“éªŒä¼˜åŒ–å±äºV2

**åŠŸèƒ½æè¿°**:

- è‡ªå®šä¹‰é…è‰²ä¸»é¢˜
- ä¼ä¸šlogoä¸é¡µçœ‰é¡µè„š
- æŠ¥è¡¨æ¨¡æ¿å¸‚åœºï¼ˆé¢„ç½®æ¨¡æ¿ï¼‰

**é¢„ä¼°å·¥ä½œé‡**: 5äººæ—¥

---

#### 2.2.3 å¤æ‚å‚æ•°è”åŠ¨ï¼ˆV2ï¼‰

**å»¶æœŸç†ç”±**: MVPæ”¯æŒåŸºç¡€å‚æ•°è¾“å…¥å³å¯ï¼Œè”åŠ¨å±äºå¢å¼ºä½“éªŒ

**åŠŸèƒ½æè¿°**:

- çœå¸‚åŒºä¸‰çº§è”åŠ¨
- æ—¥æœŸèŒƒå›´æ ¡éªŒï¼ˆå¼€å§‹æ—¥æœŸâ‰¤ç»“æŸæ—¥æœŸï¼‰
- å‚æ•°é—´ä¾èµ–å…³ç³»å®šä¹‰

**é¢„ä¼°å·¥ä½œé‡**: 3äººæ—¥

---

#### 2.2.4 å›¾è¡¨æ”¯æŒï¼ˆV2ï¼‰

**å»¶æœŸç†ç”±**: æ•°æ®å±•ç¤ºä»¥è¡¨æ ¼ä¸ºä¸»ï¼Œå›¾è¡¨å±äºå¯è§†åŒ–å¢å¼º

**åŠŸèƒ½æè¿°**:

- EChartsé›†æˆ
- æŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾
- å›¾è¡¨é…ç½®ï¼ˆåæ ‡è½´ã€é¢œè‰²ã€æ ‡é¢˜ï¼‰

**é¢„ä¼°å·¥ä½œé‡**: 5äººæ—¥

---

#### 2.2.5 å®šæ—¶ä»»åŠ¡ï¼ˆV2ï¼‰

**å»¶æœŸç†ç”±**: MVPä¸“æ³¨æ‰‹åŠ¨æŸ¥è¯¢ï¼Œè‡ªåŠ¨åŒ–å±äºè¿è¥éœ€æ±‚

**åŠŸèƒ½æè¿°**:

- å®šæ—¶æ‰§è¡ŒæŠ¥è¡¨ï¼ˆæ¯å¤©/æ¯å‘¨/æ¯æœˆï¼‰
- é‚®ä»¶å‘é€ç»“æœ
- æ‰§è¡Œç»“æœå½’æ¡£

**é¢„ä¼°å·¥ä½œé‡**: 5äººæ—¥ï¼ˆQuartz + é‚®ä»¶æœåŠ¡ï¼‰

---

#### 2.2.6 æ•°æ®ç¼“å­˜ä¼˜åŒ–ï¼ˆV2ï¼‰

**å»¶æœŸç†ç”±**: MVPé™åˆ¶5000è¡Œå¯¼å‡ºï¼Œæ€§èƒ½å‹åŠ›å¯æ§

**åŠŸèƒ½æè¿°**:

- Redisç¼“å­˜æŸ¥è¯¢ç»“æœ
- å¢é‡åˆ·æ–°
- ç¼“å­˜å¤±æ•ˆç­–ç•¥

**é¢„ä¼°å·¥ä½œé‡**: 5äººæ—¥

---

### 2.3 åŠŸèƒ½ä¼˜å…ˆçº§çŸ©é˜µ

| åŠŸèƒ½æ¨¡å—      | æ‰€å±ç«¯   | ä¼˜å…ˆçº§ | MVP | å·¥ä½œé‡ | ä¾èµ–å…³ç³»     |
| ------------- | -------- | ------ | --- | ------ | ------------ |
| SQLæŸ¥è¯¢ç®¡ç†   | è®¾è®¡ç«¯   | P0     | âœ…  | 2äººæ—¥  | æ—            |
| æŠ¥è¡¨æ¨¡æ¿è®¾è®¡  | è®¾è®¡ç«¯   | P0     | âœ…  | 2äººæ—¥  | SQLæŸ¥è¯¢ç®¡ç†  |
| æŠ¥è¡¨é¢„è§ˆ      | **è®¾è®¡ç«¯**   | P0     | âœ…  | 2äººæ—¥  | æŠ¥è¡¨æ¨¡æ¿è®¾è®¡ |
| æŠ¥è¡¨æŸ¥è¯¢      | **ç”¨æˆ·ç«¯**   | P0     | âœ…  | 2äººæ—¥  | æŠ¥è¡¨æ¨¡æ¿è®¾è®¡ |
| Excelå¯¼å‡º     | ç”¨æˆ·ç«¯   | P0     | âœ…  | 1äººæ—¥  | æŠ¥è¡¨æŸ¥è¯¢     |
| åŸºç¡€æƒé™æ§åˆ¶  | ç®¡ç†ç«¯   | P0     | âœ…  | 2äººæ—¥  | ç”¨æˆ·ç®¡ç†     |
| ç”¨æˆ·ç™»å½•/ç™»å‡º | å…¨ç«¯é€šç”¨ | P0     | âœ…  | 1äººæ—¥  | æ—            |
| é«˜çº§åˆ†ç»„æƒé™  | ç®¡ç†ç«¯   | P1     | âŒ  | 8äººæ—¥  | åŸºç¡€æƒé™     |
| æŠ¥è¡¨æ ·å¼ç¾åŒ–  | è®¾è®¡ç«¯   | P2     | âŒ  | 5äººæ—¥  | æ—            |
| å¤æ‚å‚æ•°è”åŠ¨  | ç”¨æˆ·ç«¯   | P2     | âŒ  | 3äººæ—¥  | æŠ¥è¡¨æŸ¥è¯¢     |
| å›¾è¡¨æ”¯æŒ      | ç”¨æˆ·ç«¯   | P2     | âŒ  | 5äººæ—¥  | æŠ¥è¡¨æŸ¥è¯¢     |
| å®šæ—¶ä»»åŠ¡      | è®¾è®¡ç«¯   | P2     | âŒ  | 5äººæ—¥  | æŠ¥è¡¨æ‰§è¡Œ     |
| æ•°æ®ç¼“å­˜ä¼˜åŒ–  | å…¨ç«¯é€šç”¨ | P2     | âŒ  | 5äººæ—¥  | æ—            |

**è¯´æ˜**:

- **ç®¡ç†ç«¯ï¼ˆAdminï¼‰**: ç”¨æˆ·ç®¡ç†ã€è§’è‰²åˆ†é…ã€æƒé™æ§åˆ¶
- **è®¾è®¡ç«¯ï¼ˆDesignerï¼‰**: SQLç¼–å†™ã€æŠ¥è¡¨è®¾è®¡ã€å‚æ•°é…ç½®ã€**æŠ¥è¡¨é¢„è§ˆ**ï¼ˆè®¾è®¡é˜¶æ®µçš„æµ‹è¯•æ‰§è¡Œï¼‰
- **ç”¨æˆ·ç«¯ï¼ˆViewerï¼‰**: æŠ¥è¡¨æŸ¥è¯¢ï¼ˆæŸ¥çœ‹æˆæƒæŠ¥è¡¨åˆ—è¡¨ã€é€‰æ‹©æŠ¥è¡¨ã€è¾“å…¥å‚æ•°ã€æ‰§è¡ŒæŸ¥è¯¢ï¼‰ã€Excelå¯¼å‡º
- **å…¨ç«¯é€šç”¨**: æ‰€æœ‰ç«¯éƒ½ä½¿ç”¨çš„åŸºç¡€åŠŸèƒ½

**ğŸ”„ æ ¸å¿ƒå˜æ›´**:
- âœ… **æŠ¥è¡¨é¢„è§ˆ** ä»ç”¨æˆ·ç«¯ç§»è‡³è®¾è®¡ç«¯ï¼ˆä½œä¸ºè®¾è®¡é˜¶æ®µçš„æµ‹è¯•éªŒè¯åŠŸèƒ½ï¼‰
- âœ… **æŠ¥è¡¨æŸ¥è¯¢** ä½œä¸ºç”¨æˆ·ç«¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆæ™®é€šç”¨æˆ·æŸ¥è¯¢å’ŒæŸ¥çœ‹å·²æˆæƒçš„æŠ¥è¡¨æ•°æ®ï¼‰

**MVPæ€»è®¡**: 10äººæ—¥æ ¸å¿ƒåŠŸèƒ½ + 6äººæ—¥åŸºç¡€è®¾æ–½ = **16äººæ—¥**

---

## 3. æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### 3.1 æŒ‘æˆ˜1: SQLå‚æ•°åŒ–æ‰§è¡Œçš„å®‰å…¨æ€§ ğŸ”’

#### é£é™©æè¿°

- **ä¸¥é‡æ€§**: é«˜ï¼ˆP0ï¼‰
- **é—®é¢˜**: ç”¨æˆ·è¾“å…¥æ¶æ„SQLå¯èƒ½å¯¼è‡´ï¼š
  - æ•°æ®æ³„éœ²ï¼ˆè¯»å–æ•æ„Ÿè¡¨ï¼‰
  - æ•°æ®ç ´åï¼ˆDROP TABLEã€DELETEï¼‰
  - æ€§èƒ½æ”»å‡»ï¼ˆç¬›å¡å°”ç§¯ã€æ— é™å¾ªç¯ï¼‰

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ1: SQLç™½åå•æ ¡éªŒ**

```java
public void validateSql(String sql) {
    String upperSql = sql.trim().toUpperCase();
  
    // 1. åªå…è®¸SELECTè¯­å¥
    if (!upperSql.startsWith("SELECT")) {
        throw new SecurityException("ä»…æ”¯æŒSELECTæŸ¥è¯¢");
    }
  
    // 2. å…³é”®å­—é»‘åå•
    String[] dangerousKeywords = {
        "DROP", "DELETE", "TRUNCATE", "UPDATE", 
        "INSERT", "ALTER", "CREATE", "EXEC", 
        "EXECUTE", "SCRIPT", "JAVASCRIPT"
    };
  
    for (String keyword : dangerousKeywords) {
        if (upperSql.contains(keyword)) {
            throw new SecurityException("SQLåŒ…å«å±é™©å…³é”®å­—: " + keyword);
        }
    }
}
```

**æ–¹æ¡ˆ2: åªè¯»æ•°æ®åº“è´¦å·**

- åˆ›å»ºä¸“ç”¨æ•°æ®åº“è´¦å·ï¼Œ**ä»…æˆäºˆSELECTæƒé™**
- é…ç½®ç¤ºä¾‹:

```sql
CREATE USER 'report_readonly'@'%' IDENTIFIED BY 'strong_password';
GRANT SELECT ON business_db.* TO 'report_readonly'@'%';
FLUSH PRIVILEGES;
```

**æ–¹æ¡ˆ3: PreparedStatementå‚æ•°åŒ–**

```java
// å‚æ•°å ä½ç¬¦æ›¿æ¢
String sql = "SELECT * FROM orders WHERE date >= #{startDate}";
// è½¬æ¢ä¸º: SELECT * FROM orders WHERE date >= ?
// ç»‘å®šå‚æ•°å€¼ï¼Œé˜²æ­¢SQLæ³¨å…¥
```

**æ–¹æ¡ˆ4: è¶…æ—¶æ§åˆ¶**

```java
PreparedStatement ps = conn.prepareStatement(sql);
ps.setQueryTimeout(5); // 5ç§’è¶…æ—¶
```

---

### 3.2 æŒ‘æˆ˜2: åŠ¨æ€æŸ¥è¯¢ç»“æœåˆ°å‰ç«¯è¡¨æ ¼çš„æ˜ å°„ ğŸ”„

#### é£é™©æè¿°

- **ä¸¥é‡æ€§**: é«˜ï¼ˆP0ï¼‰
- **é—®é¢˜**: ä¸åŒSQLè¿”å›ä¸åŒåˆ—ç»“æ„ï¼Œå‰ç«¯å¦‚ä½•åŠ¨æ€æ¸²æŸ“ï¼Ÿ

#### è§£å†³æ–¹æ¡ˆ

**åç«¯: è¿”å›åˆ—å…ƒæ•°æ®**

```java
public Map<String, Object> executeQuery(String sql, Map<String, Object> params) {
    ResultSet rs = ps.executeQuery();
    ResultSetMetaData meta = rs.getMetaData();
  
    // æå–åˆ—å…ƒæ•°æ®
    List<ColumnMeta> columns = new ArrayList<>();
    for (int i = 1; i <= meta.getColumnCount(); i++) {
        columns.add(new ColumnMeta(
            meta.getColumnName(i),      // å­—æ®µå
            meta.getColumnTypeName(i),  // ç±»å‹
            meta.getColumnLabel(i)      // æ˜¾ç¤ºå
        ));
    }
  
    // è½¬æ¢æ•°æ®ä¸ºList<Map>
    List<Map<String, Object>> rows = new ArrayList<>();
    while (rs.next()) {
        Map<String, Object> row = new HashMap<>();
        for (ColumnMeta col : columns) {
            row.put(col.getName(), rs.getObject(col.getName()));
        }
        rows.add(row);
    }
  
    return Map.of("columns", columns, "rows", rows);
}
```

**å‰ç«¯: VueåŠ¨æ€ç»„ä»¶æ¸²æŸ“**

```vue
<el-table :data="tableData">
  <el-table-column 
    v-for="col in columns" 
    :key="col.fieldName"
    :prop="col.fieldName"
    :label="col.displayName"
    :width="col.columnWidth">
  </el-table-column>
</el-table>
```

---

### 3.3 æŒ‘æˆ˜3: Excelå¯¼å‡ºæ€§èƒ½ ğŸ“Š

#### é£é™©æè¿°

- **ä¸¥é‡æ€§**: ä¸­ï¼ˆP1ï¼‰
- **é—®é¢˜**: å¤§æ•°æ®é‡ï¼ˆ>10000è¡Œï¼‰å¯¼å‡ºå¯èƒ½å¯¼è‡´ï¼š
  - åç«¯å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰
  - è¯·æ±‚è¶…æ—¶ï¼ˆNginxé»˜è®¤60ç§’ï¼‰
  - æµè§ˆå™¨ä¸‹è½½å¡é¡¿

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ1: é™åˆ¶å¯¼å‡ºè¡Œæ•°ï¼ˆMVPï¼‰**

```java
public byte[] exportToExcel(List<Map<String, Object>> data, ...) {
    int maxRows = Math.min(data.size(), 5000);
  
    if (data.size() > 5000) {
        // å‰ç«¯æç¤ºç”¨æˆ·æ·»åŠ ç­›é€‰æ¡ä»¶
        throw new BusinessException("æ•°æ®é‡è¿‡å¤§ï¼Œè¯·æ·»åŠ ç­›é€‰æ¡ä»¶ï¼ˆå½“å‰: " 
            + data.size() + "è¡Œï¼Œé™åˆ¶: 5000è¡Œï¼‰");
    }
  
    // ... Apache POIå¯¼å‡ºé€»è¾‘
}
```

**æ–¹æ¡ˆ2: æµå¼å¯¼å‡ºï¼ˆV2ä¼˜åŒ–ï¼‰**

```java
// ä½¿ç”¨SXSSFWorkbookï¼ˆPOIçš„æµå¼APIï¼‰
SXSSFWorkbook workbook = new SXSSFWorkbook(100); // å†…å­˜ä¿ç•™100è¡Œ
// å¤„ç†å¤§æ•°æ®é‡æ—¶ä¸ä¼šOOM
```

**æ–¹æ¡ˆ3: å¼‚æ­¥å¯¼å‡ºï¼ˆV2å¢å¼ºï¼‰**

- å‰ç«¯æäº¤å¯¼å‡ºä»»åŠ¡
- åç«¯å¼‚æ­¥ç”Ÿæˆæ–‡ä»¶
- å®Œæˆåé€šçŸ¥ç”¨æˆ·ä¸‹è½½

---

### 3.4 æŒ‘æˆ˜4: åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰ ğŸ”

#### é£é™©æè¿°

- **ä¸¥é‡æ€§**: ä¸­ï¼ˆP1ï¼‰
- **é—®é¢˜**: RBACéœ€è¦å¤šè¡¨è”æŸ¥ï¼ˆç”¨æˆ·â†’è§’è‰²â†’æŠ¥è¡¨ï¼‰ï¼Œå¦‚ä½•é«˜æ•ˆæ ¡éªŒæƒé™ï¼Ÿ

#### è§£å†³æ–¹æ¡ˆ

**MVPæ–¹æ¡ˆ: ç®€åŒ–çš„RBACï¼ˆä¸‰ä¸ªå›ºå®šè§’è‰²ï¼‰**

```java
@Service
public class PermissionService {
  
    @Autowired
    private UserRoleRepository userRoleRepo;
  
    @Autowired
    private ReportRolePermissionRepository reportRolePermissionRepo;
  
    /**
     * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®æŠ¥è¡¨
     * é€»è¾‘: ç”¨æˆ·çš„ä»»ä¸€è§’è‰²æœ‰æƒé™å³å¯è®¿é—®
     */
    public boolean hasPermission(Long userId, Long reportId) {
        // 1. è·å–ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²ID
        List<Long> userRoleIds = userRoleRepo.findRoleIdsByUserId(userId);
      
        if (userRoleIds.isEmpty()) {
            return false;
        }
      
        // 2. æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜ï¼ˆç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰æŠ¥è¡¨ï¼‰
        if (hasRole(userId, "ADMIN")) {
            return true;
        }
      
        // 3. æ£€æŸ¥ç”¨æˆ·çš„è§’è‰²æ˜¯å¦æœ‰æŠ¥è¡¨æƒé™
        return reportRolePermissionRepo.existsByReportIdAndRoleIdIn(
            reportId, userRoleIds
        );
    }
  
    /**
     * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šè§’è‰²
     */
    public boolean hasRole(Long userId, String roleCode) {
        return userRoleRepo.existsByUserIdAndRoleCode(userId, roleCode);
    }
  
    /**
     * è·å–ç”¨æˆ·å¯è®¿é—®çš„æ‰€æœ‰æŠ¥è¡¨ID
     */
    public List<Long> getAccessibleReportIds(Long userId) {
        // ç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰æŠ¥è¡¨
        if (hasRole(userId, "ADMIN")) {
            return reportRepo.findAllReportIds();
        }
      
        // è·å–ç”¨æˆ·è§’è‰²çš„æ‰€æœ‰æŠ¥è¡¨æƒé™
        List<Long> userRoleIds = userRoleRepo.findRoleIdsByUserId(userId);
        return reportRolePermissionRepo.findReportIdsByRoleIdIn(userRoleIds);
    }
}
```

**æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**

```sql
-- åŠ é€Ÿç”¨æˆ·è§’è‰²æŸ¥è¯¢
CREATE UNIQUE INDEX uk_user_role ON user_role(user_id, role_id);
CREATE INDEX idx_user_id ON user_role(user_id);

-- åŠ é€ŸæŠ¥è¡¨è§’è‰²æƒé™æŸ¥è¯¢
CREATE UNIQUE INDEX uk_report_role ON report_role_permission(report_id, role_id);
CREATE INDEX idx_role_id ON report_role_permission(role_id);
```

**æƒé™æ‹¦æˆªå™¨**

```java
@Component
public class PermissionInterceptor implements HandlerInterceptor {
  
    @Autowired
    private PermissionService permissionService;
  
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) throws Exception {
      
        // æå–æŠ¥è¡¨ID
        String uri = request.getRequestURI();
        Pattern pattern = Pattern.compile("/api/reports/(\\d+)/(execute|export)");
        Matcher matcher = pattern.matcher(uri);
      
        if (matcher.find()) {
            Long reportId = Long.parseLong(matcher.group(1));
            Long userId = getCurrentUserId(request);
          
            if (userId == null) {
                response.setStatus(401);
                response.getWriter().write("{\"error\":\"æœªç™»å½•\"}");
                return false;
            }
          
            // æ ¡éªŒRBACæƒé™
            if (!permissionService.hasPermission(userId, reportId)) {
                response.setStatus(403);
                response.getWriter().write("{\"error\":\"æ— æƒé™è®¿é—®æ­¤æŠ¥è¡¨\"}");
                return false;
            }
        }
      
        return true;
    }
}
```

**è§’è‰²æƒé™çŸ©é˜µï¼ˆç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼‰**

```java
public enum RoleType {
    ADMIN("ADMIN", "ç®¡ç†å‘˜", 3),
    DESIGNER("DESIGNER", "è®¾è®¡è€…", 2),
    VIEWER("VIEWER", "æ™®é€šç”¨æˆ·", 1);
  
    private String code;
    private String name;
    private int level;  // å±‚çº§ï¼Œæ•°å­—è¶Šå¤§æƒé™è¶Šé«˜
}
```

**V2æ‰©å±•æ–¹æ¡ˆ**:

- æ”¯æŒè‡ªå®šä¹‰è§’è‰²
- è§’è‰²ç»§æ‰¿æ ‘
- ç»†ç²’åº¦æƒé™ï¼ˆåˆ›å»º/ç¼–è¾‘/åˆ é™¤/æ‰§è¡Œ/å¯¼å‡ºï¼‰

---

### 3.5 æŒ‘æˆ˜5: å‰ç«¯çŠ¶æ€ç®¡ç† ğŸ“¦

#### é£é™©æè¿°

- **ä¸¥é‡æ€§**: ä¸­ï¼ˆP1ï¼‰
- **é—®é¢˜**: æŠ¥è¡¨é…ç½®é¡¹å¤šï¼ˆSQLã€å‚æ•°ã€åˆ—é…ç½®ã€æƒé™ï¼‰ï¼Œç»„ä»¶é—´çŠ¶æ€å…±äº«å¤æ‚

#### è§£å†³æ–¹æ¡ˆ

**VuexçŠ¶æ€ç®¡ç†**

```javascript
// store/report.js
export default {
  state: {
    currentReport: {
      id: null,
      name: '',
      sqlTemplate: '',
      params: [],
      columns: [],
      permissions: []
    },
    previewData: {
      columns: [],
      rows: []
    }
  },
  mutations: {
    SET_REPORT(state, report) {
      state.currentReport = report;
    },
    SET_PREVIEW_DATA(state, data) {
      state.previewData = data;
    }
  },
  actions: {
    async saveReport({ state }) {
      await api.post('/api/reports', state.currentReport);
    },
    async testExecute({ commit }, { sql, params }) {
      const data = await api.post('/api/reports/test-execute', { sql, params });
      commit('SET_PREVIEW_DATA', data);
    }
  }
}
```

**ç»„ä»¶é€šä¿¡**

- ReportEditor â†’ Vuex Store â†’ ReportPreview
- å•å‘æ•°æ®æµï¼ŒçŠ¶æ€å¯é¢„æµ‹

---

### 3.6 æŠ€æœ¯æŒ‘æˆ˜æ€»ç»“

| æŒ‘æˆ˜          | ä¸¥é‡æ€§ | MVPè§£å†³æ–¹æ¡ˆ          | V2å¢å¼ºæ–¹æ¡ˆ         | å·¥ä½œé‡ |
| ------------- | ------ | -------------------- | ------------------ | ------ |
| SQLå®‰å…¨æ€§     | é«˜     | ç™½åå•+åªè¯»è´¦å·+è¶…æ—¶ | SQLè§£æå™¨+æƒé™å¼•æ“ | 2äººæ—¥  |
| åŠ¨æ€åˆ—æ¸²æŸ“    | é«˜     | å…ƒæ•°æ®+VueåŠ¨æ€ç»„ä»¶   | åˆ—ç±»å‹æ™ºèƒ½è¯†åˆ«     | 1äººæ—¥  |
| Excelå¯¼å‡ºæ€§èƒ½ | ä¸­     | é™åˆ¶5000è¡Œ           | æµå¼å¯¼å‡º+å¼‚æ­¥ä»»åŠ¡  | 1äººæ—¥  |
| æƒé™æ§åˆ¶      | ä¸­     | ç”¨æˆ·-æŠ¥è¡¨ç›´æ¥å…³è”    | RBACè§’è‰²æƒé™æ¨¡å‹   | 2äººæ—¥  |
| å‰ç«¯çŠ¶æ€ç®¡ç†  | ä¸­     | Vuexé›†ä¸­ç®¡ç†         | Piniaï¼ˆVue3ï¼‰      | 1äººæ—¥  |

**æ€»è®¡**: 7äººæ—¥æŠ€æœ¯æ”»åš

---

## 4. æŠ€æœ¯æ¶æ„è®¾è®¡

### 4.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯å±‚ (Vue.js)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è®¾è®¡ç«¯        â”‚            å®¢æˆ·ç«¯                           â”‚
â”‚  - æŠ¥è¡¨ç¼–è¾‘å™¨   â”‚          - æŠ¥è¡¨åˆ—è¡¨                         â”‚
â”‚  - å‚æ•°é…ç½®     â”‚          - æŠ¥è¡¨æŸ¥çœ‹å™¨                       â”‚
â”‚  - æƒé™ç®¡ç†     â”‚          - Excelå¯¼å‡º                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“  HTTP/JSON  â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åç«¯å±‚ (SpringBoot)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Controllerå±‚                                                â”‚
â”‚  - ReportDesignController  - ReportViewerController          â”‚
â”‚  - UserController          - PermissionController            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Serviceå±‚                                                   â”‚
â”‚  - QueryExecutorService (SQLæ‰§è¡Œå¼•æ“)   â­æ ¸å¿ƒ               â”‚
â”‚  - ReportService (æŠ¥è¡¨CRUD)                                  â”‚
â”‚  - ExportService (Excelå¯¼å‡º)            â­æ ¸å¿ƒ               â”‚
â”‚  - PermissionService (æƒé™æ ¡éªŒ)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Repositoryå±‚                                                â”‚
â”‚  - ReportRepository  - ReportParamRepository                 â”‚
â”‚  - ReportColumnRepository  - PermissionRepository            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“  JDBC  â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®å±‚ (MySQL 5.7+)                       â”‚
â”‚  - report (æŠ¥è¡¨å®šä¹‰)    - report_param (å‚æ•°)                 â”‚
â”‚  - report_column (åˆ—é…ç½®)  - report_permission (æƒé™)         â”‚
â”‚  - user (ç”¨æˆ·)          - report_execution_log (æ‰§è¡Œæ—¥å¿—)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.2 åç«¯æ¶æ„ (SpringBoot)

#### 4.2.1 ç›®å½•ç»“æ„

```
src/main/java/com/example/reporttool/
â”œâ”€â”€ controller/              # APIå±‚
â”‚   â”œâ”€â”€ ReportDesignController.java    # è®¾è®¡ç«¯API
â”‚   â”œâ”€â”€ ReportViewerController.java    # å®¢æˆ·ç«¯API
â”‚   â”œâ”€â”€ UserController.java            # ç”¨æˆ·ç®¡ç†
â”‚   â””â”€â”€ PermissionController.java      # æƒé™ç®¡ç†
â”‚
â”œâ”€â”€ service/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ QueryExecutorService.java      # SQLæ‰§è¡Œå¼•æ“ â­
â”‚   â”œâ”€â”€ ReportService.java             # æŠ¥è¡¨CRUD
â”‚   â”œâ”€â”€ ExportService.java             # Excelå¯¼å‡º â­
â”‚   â”œâ”€â”€ PermissionService.java         # æƒé™æ ¡éªŒ
â”‚   â””â”€â”€ UserService.java               # ç”¨æˆ·æœåŠ¡
â”‚
â”œâ”€â”€ repository/              # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ ReportRepository.java
â”‚   â”œâ”€â”€ ReportParamRepository.java
â”‚   â”œâ”€â”€ ReportColumnRepository.java
â”‚   â”œâ”€â”€ ReportPermissionRepository.java
â”‚   â””â”€â”€ UserRepository.java
â”‚
â”œâ”€â”€ entity/                  # å®ä½“ç±»
â”‚   â”œâ”€â”€ Report.java
â”‚   â”œâ”€â”€ ReportParam.java
â”‚   â”œâ”€â”€ ReportColumn.java
â”‚   â”œâ”€â”€ ReportPermission.java
â”‚   â”œâ”€â”€ User.java
â”‚   â””â”€â”€ ReportExecutionLog.java
â”‚
â”œâ”€â”€ dto/                     # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ ReportDTO.java
â”‚   â”œâ”€â”€ ExecuteRequestDTO.java
â”‚   â””â”€â”€ QueryResultDTO.java
â”‚
â”œâ”€â”€ util/                    # å·¥å…·ç±»
â”‚   â”œâ”€â”€ SqlValidator.java              # SQLå®‰å…¨æ ¡éªŒ
â”‚   â”œâ”€â”€ ExcelExporter.java             # POIå°è£…
â”‚   â””â”€â”€ ParameterConverter.java        # å‚æ•°ç±»å‹è½¬æ¢
â”‚
â”œâ”€â”€ interceptor/             # æ‹¦æˆªå™¨
â”‚   â””â”€â”€ PermissionInterceptor.java     # æƒé™æ‹¦æˆª
â”‚
â”œâ”€â”€ config/                  # é…ç½®ç±»
â”‚   â”œâ”€â”€ WebMvcConfig.java              # Webé…ç½®
â”‚   â”œâ”€â”€ DataSourceConfig.java          # æ•°æ®æºé…ç½®
â”‚   â””â”€â”€ SecurityConfig.java            # å®‰å…¨é…ç½®
â”‚
â””â”€â”€ exception/               # å¼‚å¸¸å¤„ç†
    â”œâ”€â”€ BusinessException.java
    â””â”€â”€ GlobalExceptionHandler.java
```

---

#### 4.2.2 å…³é”®æŠ€æœ¯é€‰å‹

| æŠ€æœ¯ç»„ä»¶         | é€‰å‹æ–¹æ¡ˆ              | ç‰ˆæœ¬   | ç†ç”±                            |
| ---------------- | --------------------- | ------ | ------------------------------- |
| Webæ¡†æ¶          | SpringBoot            | 2.7.x  | ä¸»æµä¼ä¸šçº§æ¡†æ¶                  |
| ORMæ¡†æ¶          | Spring Data JPA       | 2.7.x  | ç®€åŒ–CRUDæ“ä½œ                    |
| æ•°æ®åº“è¿æ¥æ±      | Druid                 | 1.2.x  | æ”¯æŒSQLç›‘æ§                     |
| Excelå¯¼å‡º        | Apache POI            | 5.2.x  | ä¸»æµæ–¹æ¡ˆï¼Œç¤¾åŒºæ´»è·ƒ              |
| å‚æ•°æ ¡éªŒ         | Hibernate Validator   | 7.0.x  | Bean Validationæ ‡å‡†å®ç°         |
| æ—¥å¿—æ¡†æ¶         | Logback               | 1.2.x  | SpringBooté»˜è®¤                  |
| JSONå¤„ç†         | Jackson               | 2.13.x | SpringBooté»˜è®¤                  |
| æƒé™æ¡†æ¶ï¼ˆå¯é€‰ï¼‰ | æ‹¦æˆªå™¨/SpringSecurity | -      | MVPç”¨æ‹¦æˆªå™¨ï¼ŒV2ç”¨SpringSecurity |

---

### 4.3 å‰ç«¯æ¶æ„ (Vue.js)

#### 4.3.1 ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ main.js                  # å…¥å£æ–‡ä»¶
â”œâ”€â”€ App.vue                  # æ ¹ç»„ä»¶
â”œâ”€â”€ router/                  # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ index.js
â”‚
â”œâ”€â”€ store/                   # VuexçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ report.js        # æŠ¥è¡¨çŠ¶æ€
â”‚       â””â”€â”€ user.js          # ç”¨æˆ·çŠ¶æ€
â”‚
â”œâ”€â”€ views/                   # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ design/              # è®¾è®¡ç«¯
â”‚   â”‚   â”œâ”€â”€ ReportList.vue           # æŠ¥è¡¨åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ ReportEditor.vue         # æŠ¥è¡¨ç¼–è¾‘å™¨ â­
â”‚   â”‚   â””â”€â”€ PermissionManager.vue    # æƒé™è®¾ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ viewer/              # å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ ReportList.vue           # æˆ‘çš„æŠ¥è¡¨
â”‚   â”‚   â””â”€â”€ ReportViewer.vue         # æŠ¥è¡¨æŸ¥çœ‹ â­
â”‚   â”‚
â”‚   â””â”€â”€ auth/                # è®¤è¯
â”‚       â”œâ”€â”€ Login.vue
â”‚       â””â”€â”€ Register.vue
â”‚
â”œâ”€â”€ components/              # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ SqlEditor.vue                # SQLç¼–è¾‘å™¨(CodeMirror)
â”‚   â”œâ”€â”€ ParamForm.vue                # å‚æ•°è¡¨å•
â”‚   â”œâ”€â”€ DataTable.vue                # æ•°æ®è¡¨æ ¼
â”‚   â””â”€â”€ ExportButton.vue             # å¯¼å‡ºæŒ‰é’®
â”‚
â”œâ”€â”€ api/                     # APIå°è£…
â”‚   â”œâ”€â”€ request.js                   # Axioså°è£…
â”‚   â”œâ”€â”€ report.js                    # æŠ¥è¡¨API
â”‚   â”œâ”€â”€ user.js                      # ç”¨æˆ·API
â”‚   â””â”€â”€ permission.js                # æƒé™API
â”‚
â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ auth.js                      # è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ validator.js                 # è¡¨å•æ ¡éªŒ
â”‚   â””â”€â”€ formatter.js                 # æ•°æ®æ ¼å¼åŒ–
â”‚
â””â”€â”€ assets/                  # é™æ€èµ„æº
    â”œâ”€â”€ styles/
    â””â”€â”€ images/
```

---

#### 4.3.2 å…³é”®æŠ€æœ¯é€‰å‹

| æŠ€æœ¯ç»„ä»¶   | é€‰å‹æ–¹æ¡ˆ   | ç‰ˆæœ¬   | ç†ç”±                   |
| ---------- | ---------- | ------ | ---------------------- |
| æ¡†æ¶       | Vue.js     | 2.6.x  | æˆç†Ÿç¨³å®šï¼Œå›¢é˜Ÿç†Ÿæ‚‰     |
| UIç»„ä»¶åº“   | Element UI | 2.15.x | ä¼ä¸šçº§ç»„ä»¶åº“ï¼Œå¿«é€Ÿå¼€å‘ |
| çŠ¶æ€ç®¡ç†   | Vuex       | 3.6.x  | Vueå®˜æ–¹çŠ¶æ€ç®¡ç†        |
| è·¯ç”±       | Vue Router | 3.5.x  | Vueå®˜æ–¹è·¯ç”±            |
| HTTPå®¢æˆ·ç«¯ | Axios      | 1.4.x  | ä¸»æµHTTPåº“             |
| SQLç¼–è¾‘å™¨  | CodeMirror | 5.65.x | è½»é‡SQLè¯­æ³•é«˜äº®        |
| æ„å»ºå·¥å…·   | Vue CLI    | 5.0.x  | Vueå®˜æ–¹è„šæ‰‹æ¶          |
| ä»£ç è§„èŒƒ   | ESLint     | 8.x    | ä»£ç è´¨é‡ä¿è¯           |

---

### 4.4 æ•°æ®æµè®¾è®¡

#### 4.4.1 æŠ¥è¡¨è®¾è®¡æµç¨‹

```
è®¾è®¡ç«¯ç”¨æˆ·æ“ä½œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¾“å…¥SQL  â”‚
â”‚ 2. å®šä¹‰å‚æ•° â”‚
â”‚ 3. æµ‹è¯•æ‰§è¡Œ â”‚ â†’ POST /api/reports/test-execute
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â†“
                  {sqlTemplate, params}
                  â†“
           [QueryExecutorService]
                  â†“
           æ‰§è¡ŒSQLï¼Œè¿”å›ç»“æœ+å…ƒæ•°æ®
                  â†“
           {columns: [...], rows: [...]}
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. é…ç½®åˆ—   â”‚ â† è‡ªåŠ¨æå–å­—æ®µå
â”‚ 5. ä¿å­˜æŠ¥è¡¨ â”‚ â†’ POST /api/reports
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â†“
                  {name, sql, params, columns}
                  â†“
           [ReportService]
                  â†“
           ä¿å­˜åˆ°æ•°æ®åº“ (4å¼ è¡¨)
                  â†“
           è¿”å›æŠ¥è¡¨ID
```

---

#### 4.4.2 æŠ¥è¡¨æŸ¥çœ‹æµç¨‹

```
å®¢æˆ·ç«¯ç”¨æˆ·æ“ä½œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æŸ¥çœ‹åˆ—è¡¨ â”‚ â†’ GET /api/viewer/reports
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â†“
                  [PermissionInterceptor] æ ¡éªŒç”¨æˆ·èº«ä»½
                  â†“
           [PermissionService] æŸ¥è¯¢ç”¨æˆ·è§’è‰²çš„æŠ¥è¡¨æƒé™ï¼ˆRBACï¼‰
                  â†“
           è¿”å›æŠ¥è¡¨åˆ—è¡¨
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ç‚¹å‡»æŠ¥è¡¨ â”‚ â†’ GET /api/reports/{id}
â”‚ 3. è¾“å…¥å‚æ•° â”‚
â”‚ 4. ç‚¹å‡»æŸ¥è¯¢ â”‚ â†’ POST /api/reports/{id}/execute
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â†“
                  {reportId, paramValues}
                  â†“
           [PermissionInterceptor] æ ¡éªŒè§’è‰²è®¿é—®æƒé™ï¼ˆRBACï¼‰
                  â†“
           [QueryExecutorService] æ‰§è¡ŒSQL
                  â†“
           [ReportExecutionLog] è®°å½•æ—¥å¿—
                  â†“
           è¿”å›æŸ¥è¯¢ç»“æœ
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. å¯¼å‡ºExcelâ”‚ â†’ GET /api/reports/{id}/export?params=...
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â†“
                  [ExportService] ç”ŸæˆExcel
                  â†“
           è¿”å›æ–‡ä»¶æµ (application/vnd.ms-excel)
                  â†“
           æµè§ˆå™¨ä¸‹è½½
```

---

### 4.5 æ¥å£è®¾è®¡ (RESTful API)

#### 4.5.1 ç®¡ç†ç«¯APIï¼ˆAdminï¼‰

| æ¥å£                            | æ–¹æ³•   | æè¿°           | è¯·æ±‚ä½“                        | å“åº”              | æƒé™è¦æ±‚ |
| ------------------------------- | ------ | -------------- | ----------------------------- | ----------------- | -------- |
| `/api/admin/users`            | GET    | æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨   | -                             | `List<User>`    | ADMIN    |
| `/api/admin/users`            | POST   | åˆ›å»ºç”¨æˆ·       | `{username, password, ...}` | `{id, message}` | ADMIN    |
| `/api/admin/users/{id}`       | PUT    | æ›´æ–°ç”¨æˆ·       | `{real_name, email, ...}`   | `{message}`     | ADMIN    |
| `/api/admin/users/{id}`       | DELETE | åˆ é™¤ç”¨æˆ·       | -                             | `{message}`     | ADMIN    |
| `/api/admin/users/{id}/roles` | POST   | ä¸ºç”¨æˆ·åˆ†é…è§’è‰² | `{roleIds[]}`               | `{message}`     | ADMIN    |
| `/api/admin/roles`            | GET    | æŸ¥è¯¢è§’è‰²åˆ—è¡¨   | -                             | `List<Role>`    | ADMIN    |

---

#### 4.5.2 è®¾è®¡ç«¯APIï¼ˆDesignerï¼‰

| æ¥å£                                 | æ–¹æ³•   | æè¿°               | è¯·æ±‚ä½“                    | å“åº”               | æƒé™è¦æ±‚  |
| ------------------------------------ | ------ | ------------------ | ------------------------- | ------------------ | --------- |
| `/api/reports`                     | GET    | æŸ¥è¯¢æˆ‘çš„æŠ¥è¡¨åˆ—è¡¨   | -                         | `List<Report>`   | DESIGNER+ |
| `/api/reports/{id}`                | GET    | æŸ¥è¯¢æŠ¥è¡¨è¯¦æƒ…       | -                         | `ReportDTO`      | DESIGNER+ |
| `/api/reports`                     | POST   | åˆ›å»ºæŠ¥è¡¨           | `ReportDTO`             | `{id, message}`  | DESIGNER+ |
| `/api/reports/{id}`                | PUT    | æ›´æ–°æŠ¥è¡¨           | `ReportDTO`             | `{message}`      | DESIGNER+ |
| `/api/reports/{id}`                | DELETE | åˆ é™¤æŠ¥è¡¨           | -                         | `{message}`      | DESIGNER+ |
| `/api/reports/test-execute`        | POST   | æµ‹è¯•æ‰§è¡ŒSQL        | `{sqlTemplate, params}` | `QueryResultDTO` | DESIGNER+ |
| `/api/reports/{id}/roles`          | GET    | æŸ¥è¯¢æŠ¥è¡¨æˆæƒçš„è§’è‰² | -                         | `List<Role>`     | DESIGNER+ |
| `/api/reports/{id}/roles`          | POST   | ä¸ºæŠ¥è¡¨åˆ†é…è§’è‰²æƒé™ | `{roleIds[]}`           | `{message}`      | DESIGNER+ |
| `/api/reports/{id}/roles/{roleId}` | DELETE | å–æ¶ˆè§’è‰²æƒé™       | -                         | `{message}`      | DESIGNER+ |

---

#### 4.5.3 ç”¨æˆ·ç«¯APIï¼ˆViewerï¼‰

| æ¥å£                          | æ–¹æ³• | æè¿°               | è¯·æ±‚ä½“                       | å“åº”               | æƒé™è¦æ±‚ |
| ----------------------------- | ---- | ------------------ | ---------------------------- | ------------------ | -------- |
| `/api/viewer/reports`       | GET  | æŸ¥è¯¢æˆ‘æœ‰æƒé™çš„æŠ¥è¡¨ | -                            | `List<Report>`   | VIEWER+  |
| `/api/reports/{id}/execute` | POST | æ‰§è¡ŒæŠ¥è¡¨æŸ¥è¯¢       | `{paramValues}`            | `QueryResultDTO` | VIEWER+  |
| `/api/reports/{id}/export`  | GET  | å¯¼å‡ºExcel          | Queryå‚æ•°:`?startDate=...` | æ–‡ä»¶æµ (xlsx)      | VIEWER+  |

**æ³¨**ï¼š`DESIGNER+` è¡¨ç¤º DESIGNER å’Œ ADMIN è§’è‰²éƒ½å¯è®¿é—®ï¼Œ`VIEWER+` è¡¨ç¤ºæ‰€æœ‰è§’è‰²éƒ½å¯è®¿é—®ã€‚

---

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â†“
                  {reportId, paramValues}
                  â†“
           [PermissionInterceptor] æ ¡éªŒè®¿é—®æƒé™
                  â†“
           [QueryExecutorService] æ‰§è¡ŒSQL
                  â†“
           [ReportExecutionLog] è®°å½•æ—¥å¿—
                  â†“
           è¿”å›æŸ¥è¯¢ç»“æœ
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. å¯¼å‡ºExcelâ”‚ â†’ GET /api/reports/{id}/export?params=...
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â†“
                  [ExportService] ç”ŸæˆExcel
                  â†“
           è¿”å›æ–‡ä»¶æµ (application/vnd.ms-excel)
                  â†“
           æµè§ˆå™¨ä¸‹è½½

```

---

### 4.5 æ¥å£è®¾è®¡ (RESTful API)

#### 4.5.1 è®¾è®¡ç«¯API

| æ¥å£                        | æ–¹æ³•   | æè¿°                    | è¯·æ±‚ä½“                          | å“åº”                   |
|----------------------------|--------|------------------------|--------------------------------|----------------------|
| `/api/reports`             | GET    | æŸ¥è¯¢æŠ¥è¡¨åˆ—è¡¨             | -                              | `List<Report>`       |
| `/api/reports/{id}`        | GET    | æŸ¥è¯¢æŠ¥è¡¨è¯¦æƒ…             | -                              | `ReportDTO`          |
| `/api/reports`             | POST   | åˆ›å»ºæŠ¥è¡¨                | `ReportDTO`                    | `{id, message}`      |
| `/api/reports/{id}`        | PUT    | æ›´æ–°æŠ¥è¡¨                | `ReportDTO`                    | `{message}`          |
| `/api/reports/{id}`        | DELETE | åˆ é™¤æŠ¥è¡¨                | -                              | `{message}`          |
| `/api/reports/test-execute`| POST   | æµ‹è¯•æ‰§è¡ŒSQL             | `{sqlTemplate, params}`        | `QueryResultDTO`     |
| `/api/permissions`         | POST   | åˆ†é…æƒé™                | `{reportId, userIds[]}`        | `{message}`          |
| `/api/permissions/{reportId}` | GET | æŸ¥è¯¢æŠ¥è¡¨æƒé™             | -                              | `List<User>`         |

---

#### 4.5.2 å®¢æˆ·ç«¯API

| æ¥å£                          | æ–¹æ³•   | æè¿°                    | è¯·æ±‚ä½“                          | å“åº”                   |
|------------------------------|--------|------------------------|--------------------------------|----------------------|
| `/api/viewer/reports`        | GET    | æŸ¥è¯¢æˆ‘çš„æŠ¥è¡¨ï¼ˆæœ‰æƒé™çš„ï¼‰   | -                              | `List<Report>`       |
| `/api/reports/{id}/execute`  | POST   | æ‰§è¡ŒæŠ¥è¡¨æŸ¥è¯¢             | `{paramValues}`                | `QueryResultDTO`     |
| `/api/reports/{id}/export`   | GET    | å¯¼å‡ºExcel               | Queryå‚æ•°: `?startDate=...`     | æ–‡ä»¶æµ (xlsx)         |

---

#### 4.5.3 ç»Ÿä¸€å“åº”æ ¼å¼

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    // ä¸šåŠ¡æ•°æ®
  },
  "timestamp": "2025-12-26T10:30:00"
}
```

**é”™è¯¯å“åº”**:

```json
{
  "code": 403,
  "message": "æ— æƒé™è®¿é—®æ­¤æŠ¥è¡¨",
  "error": "PermissionDeniedException",
  "timestamp": "2025-12-26T10:30:00"
}
```

---

## 5. æ•°æ®åº“è®¾è®¡

### 5.1 æ ¸å¿ƒè¡¨ç»“æ„

#### 5.1.1 æŠ¥è¡¨å®šä¹‰è¡¨ (report)

```sql
CREATE TABLE `report` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æŠ¥è¡¨ID',
  `name` VARCHAR(100) NOT NULL COMMENT 'æŠ¥è¡¨åç§°',
  `description` TEXT COMMENT 'æŠ¥è¡¨æè¿°',
  `sql_template` TEXT NOT NULL COMMENT 'SQLæ¨¡æ¿ï¼ˆå«å‚æ•°å ä½ç¬¦ #{paramName}ï¼‰',
  `creator_id` BIGINT NOT NULL COMMENT 'åˆ›å»ºäººID',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ 0åœç”¨',
  INDEX `idx_creator` (`creator_id`),
  INDEX `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æŠ¥è¡¨å®šä¹‰è¡¨';
```

**ç¤ºä¾‹æ•°æ®**:

```sql
INSERT INTO report (name, description, sql_template, creator_id) VALUES
('é”€å”®æ—¥æŠ¥', 'ç»Ÿè®¡æ¯æ—¥é”€å”®é¢', 'SELECT date, SUM(amount) as total FROM orders WHERE date >= #{startDate} AND date <= #{endDate} GROUP BY date', 1);
```

---

#### 5.1.2 å‚æ•°å®šä¹‰è¡¨ (report_param)

```sql
CREATE TABLE `report_param` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å‚æ•°ID',
  `report_id` BIGINT NOT NULL COMMENT 'æŠ¥è¡¨ID',
  `param_name` VARCHAR(50) NOT NULL COMMENT 'å‚æ•°åï¼ˆå¯¹åº”#{paramName}ï¼‰',
  `param_type` VARCHAR(20) NOT NULL COMMENT 'å‚æ•°ç±»å‹ï¼šSTRING/INT/DATE/DATETIME',
  `default_value` VARCHAR(200) COMMENT 'é»˜è®¤å€¼',
  `is_required` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å¿…å¡«ï¼š1æ˜¯ 0å¦',
  `param_order` INT DEFAULT 0 COMMENT 'æ˜¾ç¤ºé¡ºåº',
  FOREIGN KEY (`report_id`) REFERENCES `report`(`id`) ON DELETE CASCADE,
  INDEX `idx_report_id` (`report_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æŠ¥è¡¨å‚æ•°è¡¨';
```

**ç¤ºä¾‹æ•°æ®**:

```sql
INSERT INTO report_param (report_id, param_name, param_type, default_value, is_required, param_order) VALUES
(1, 'startDate', 'DATE', '2025-01-01', 1, 1),
(1, 'endDate', 'DATE', '2025-01-31', 1, 2);
```

---

#### 5.1.3 åˆ—é…ç½®è¡¨ (report_column)

```sql
CREATE TABLE `report_column` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'åˆ—ID',
  `report_id` BIGINT NOT NULL COMMENT 'æŠ¥è¡¨ID',
  `field_name` VARCHAR(50) NOT NULL COMMENT 'å­—æ®µåï¼ˆæ¥è‡ªSQLç»“æœé›†ï¼‰',
  `display_name` VARCHAR(100) COMMENT 'æ˜¾ç¤ºåç§°ï¼ˆä¸­æ–‡åï¼‰',
  `column_width` INT COMMENT 'åˆ—å®½ï¼ˆpxï¼‰',
  `data_format` VARCHAR(50) COMMENT 'æ ¼å¼åŒ–ç±»å‹ï¼šdate/number/currency',
  `column_order` INT DEFAULT 0 COMMENT 'æ˜¾ç¤ºé¡ºåº',
  FOREIGN KEY (`report_id`) REFERENCES `report`(`id`) ON DELETE CASCADE,
  INDEX `idx_report_id` (`report_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æŠ¥è¡¨åˆ—é…ç½®è¡¨';
```

**ç¤ºä¾‹æ•°æ®**:

```sql
INSERT INTO report_column (report_id, field_name, display_name, column_width, data_format, column_order) VALUES
(1, 'date', 'æ—¥æœŸ', 120, 'date', 1),
(1, 'total', 'é”€å”®é¢', 150, 'currency', 2);
```

---

#### 5.1.4 è§’è‰²è¡¨ (role)

```sql
CREATE TABLE `role` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è§’è‰²ID',
  `role_code` VARCHAR(20) NOT NULL UNIQUE COMMENT 'è§’è‰²ç¼–ç ï¼šADMIN/DESIGNER/VIEWER',
  `role_name` VARCHAR(50) NOT NULL COMMENT 'è§’è‰²åç§°',
  `description` TEXT COMMENT 'è§’è‰²æè¿°',
  `level` INT NOT NULL COMMENT 'è§’è‰²å±‚çº§ï¼ˆæ•°å­—è¶Šå¤§æƒé™è¶Šé«˜ï¼‰',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  INDEX `idx_role_code` (`role_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²è¡¨';
```

**ç¤ºä¾‹æ•°æ®**:

```sql
INSERT INTO role (role_code, role_name, description, level) VALUES
('ADMIN', 'ç®¡ç†å‘˜', 'æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œå¯ç®¡ç†ç”¨æˆ·å’Œè§’è‰²', 3),
('DESIGNER', 'è®¾è®¡è€…', 'å¯åˆ›å»ºå’Œç®¡ç†æŠ¥è¡¨ï¼Œåˆ†é…æŠ¥è¡¨æƒé™', 2),
('VIEWER', 'æ™®é€šç”¨æˆ·', 'åªèƒ½æŸ¥çœ‹æˆæƒçš„æŠ¥è¡¨', 1);
```

---

#### 5.1.5 ç”¨æˆ·è§’è‰²å…³è”è¡¨ (user_role)

```sql
CREATE TABLE `user_role` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `role_id` BIGINT NOT NULL COMMENT 'è§’è‰²ID',
  `granted_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æˆæƒæ—¶é—´',
  `granted_by` BIGINT COMMENT 'æˆæƒäººID',
  UNIQUE KEY `uk_user_role` (`user_id`, `role_id`) COMMENT 'ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²',
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`role_id`) REFERENCES `role`(`id`) ON DELETE CASCADE,
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_role_id` (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

**ç¤ºä¾‹æ•°æ®**:

```sql
INSERT INTO user_role (user_id, role_id, granted_by) VALUES
(1, 1, NULL),  -- ç”¨æˆ·1æ˜¯ç®¡ç†å‘˜
(2, 2, 1),     -- ç”¨æˆ·2æ˜¯è®¾è®¡è€…ï¼Œç”±ç®¡ç†å‘˜æˆæƒ
(3, 3, 1);     -- ç”¨æˆ·3æ˜¯æ™®é€šç”¨æˆ·ï¼Œç”±ç®¡ç†å‘˜æˆæƒ
```

---

#### 5.1.6 æŠ¥è¡¨è§’è‰²æƒé™è¡¨ (report_role_permission)

```sql
CREATE TABLE `report_role_permission` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æƒé™ID',
  `report_id` BIGINT NOT NULL COMMENT 'æŠ¥è¡¨ID',
  `role_id` BIGINT NOT NULL COMMENT 'è§’è‰²ID',
  `granted_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æˆæƒæ—¶é—´',
  `granted_by` BIGINT COMMENT 'æˆæƒäººID',
  UNIQUE KEY `uk_report_role` (`report_id`, `role_id`) COMMENT 'è”åˆå”¯ä¸€ç´¢å¼•ï¼ˆåŠ é€Ÿæƒé™æŸ¥è¯¢ï¼‰',
  FOREIGN KEY (`report_id`) REFERENCES `report`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`role_id`) REFERENCES `role`(`id`) ON DELETE CASCADE,
  INDEX `idx_report_id` (`report_id`),
  INDEX `idx_role_id` (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æŠ¥è¡¨è§’è‰²æƒé™è¡¨ï¼ˆRBACï¼‰';
```

**ç¤ºä¾‹æ•°æ®**:

```sql
INSERT INTO report_role_permission (report_id, role_id, granted_by) VALUES
(1, 2, 1),  -- æŠ¥è¡¨1æˆæƒç»™è®¾è®¡è€…è§’è‰²ï¼Œç”±ç®¡ç†å‘˜æˆæƒ
(1, 3, 1);  -- æŠ¥è¡¨1æˆæƒç»™æ™®é€šç”¨æˆ·è§’è‰²ï¼Œç”±ç®¡ç†å‘˜æˆæƒ
```

---

#### 5.1.7 ç”¨æˆ·è¡¨ (user)

```sql
CREATE TABLE `user` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `username` VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·åï¼ˆç™»å½•åï¼‰',
  `password` VARCHAR(200) NOT NULL COMMENT 'å¯†ç ï¼ˆBCryptåŠ å¯†ï¼‰',
  `real_name` VARCHAR(50) COMMENT 'çœŸå®å§“å',
  `email` VARCHAR(100) COMMENT 'é‚®ç®±',
  `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ 0åœç”¨',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  INDEX `idx_username` (`username`),
  INDEX `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

**ç¤ºä¾‹æ•°æ®**:

```sql
INSERT INTO user (username, password, real_name, email) VALUES
('admin', '$2a$10$...', 'ç®¡ç†å‘˜', 'admin@example.com'),
('designer1', '$2a$10$...', 'è®¾è®¡è€…å¼ ä¸‰', 'designer1@example.com'),
('user1', '$2a$10$...', 'æ™®é€šç”¨æˆ·æå››', 'user1@example.com');
```

---

#### 5.1.6 æ‰§è¡Œæ—¥å¿—è¡¨ (report_execution_log)

```sql
CREATE TABLE `report_execution_log` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
  `report_id` BIGINT NOT NULL COMMENT 'æŠ¥è¡¨ID',
  `user_id` BIGINT NOT NULL COMMENT 'æ‰§è¡ŒäººID',
  `param_values` JSON COMMENT 'å‚æ•°å€¼ï¼ˆJSONæ ¼å¼ï¼‰',
  `execution_time` INT COMMENT 'æ‰§è¡Œè€—æ—¶ï¼ˆæ¯«ç§’ï¼‰',
  `result_rows` INT COMMENT 'ç»“æœè¡Œæ•°',
  `status` VARCHAR(20) COMMENT 'çŠ¶æ€ï¼šSUCCESS/ERROR',
  `error_message` TEXT COMMENT 'é”™è¯¯ä¿¡æ¯ï¼ˆstatus=ERRORæ—¶ï¼‰',
  `executed_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ‰§è¡Œæ—¶é—´',
  INDEX `idx_report_id` (`report_id`),
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_executed_at` (`executed_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æŠ¥è¡¨æ‰§è¡Œæ—¥å¿—è¡¨';
```

**ç¤ºä¾‹æ•°æ®**:

```sql
INSERT INTO report_execution_log (report_id, user_id, param_values, execution_time, result_rows, status) VALUES
(1, 2, '{"startDate":"2025-01-01","endDate":"2025-01-31"}', 234, 31, 'SUCCESS');
```

---

### 5.2 E-R å›¾ï¼ˆRBACæƒé™æ¨¡å‹ï¼‰

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     role     â”‚
                    â”‚ (è§’è‰²è¡¨)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
                 N  â”‚             â”‚  N
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”      â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ user_role  â”‚      â”‚ report_role_     â”‚
          â”‚ (ç”¨æˆ·è§’è‰²)  â”‚      â”‚ permission       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜      â”‚ (æŠ¥è¡¨è§’è‰²æƒé™)    â”‚
                 1  â”‚         â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚             â”‚ 1
              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”       â”‚
              â”‚   user    â”‚       â”‚ N
              â”‚ (ç”¨æˆ·è¡¨)   â”‚       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ 1      â”‚   report    â”‚
                    â”‚        â”‚  (æŠ¥è¡¨è¡¨)    â”‚
                    â”‚ N      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”        â”‚ 1
         â”‚ report_       â”‚        â”‚
         â”‚ execution_log â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ N       â”‚ N       â”‚ N
                           â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â” â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â”€â”
                           â”‚report_   â”‚ â”‚report_ â”‚ â”‚report_â”‚
                           â”‚param     â”‚ â”‚column  â”‚ â”‚...    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³ç³»è¯´æ˜**:

- ç”¨æˆ· â†” è§’è‰²: å¤šå¯¹å¤šï¼ˆä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²ï¼‰
- è§’è‰² â†” æŠ¥è¡¨: å¤šå¯¹å¤šï¼ˆé€šè¿‡report_role_permissionè¡¨ï¼‰
- ç”¨æˆ· â†” æŠ¥è¡¨: é—´æ¥å…³ç³»ï¼ˆé€šè¿‡è§’è‰²ï¼‰
- æŠ¥è¡¨ â†” å‚æ•°/åˆ—: ä¸€å¯¹å¤š

---

### 5.3 ç´¢å¼•è®¾è®¡è¯´æ˜

| è¡¨å                   | ç´¢å¼•å­—æ®µ             | ç´¢å¼•ç±»å‹ | ç›®çš„                       |
| ---------------------- | -------------------- | -------- | -------------------------- |
| report                 | creator_id           | æ™®é€šç´¢å¼• | æŸ¥è¯¢æˆ‘åˆ›å»ºçš„æŠ¥è¡¨           |
| report                 | status               | æ™®é€šç´¢å¼• | è¿‡æ»¤å¯ç”¨/åœç”¨çš„æŠ¥è¡¨        |
| role                   | role_code            | æ™®é€šç´¢å¼• | æŒ‰è§’è‰²ç¼–ç æŸ¥è¯¢             |
| user_role              | (user_id, role_id)   | å”¯ä¸€ç´¢å¼• | é˜²æ­¢é‡å¤æˆæƒï¼ŒåŠ é€ŸæŸ¥è¯¢     |
| user_role              | user_id              | æ™®é€šç´¢å¼• | æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²         |
| user_role              | role_id              | æ™®é€šç´¢å¼• | æŸ¥è¯¢è§’è‰²ä¸‹çš„æ‰€æœ‰ç”¨æˆ·       |
| report_role_permission | (report_id, role_id) | å”¯ä¸€ç´¢å¼• | æƒé™æŸ¥è¯¢O(1)ï¼Œé˜²æ­¢é‡å¤æˆæƒ |
| report_role_permission | report_id            | æ™®é€šç´¢å¼• | æŸ¥è¯¢æŠ¥è¡¨çš„æˆæƒè§’è‰²         |
| report_role_permission | role_id              | æ™®é€šç´¢å¼• | æŸ¥è¯¢è§’è‰²å¯è®¿é—®çš„æŠ¥è¡¨       |
| report_param           | report_id            | æ™®é€šç´¢å¼• | æŸ¥è¯¢æŠ¥è¡¨çš„å‚æ•°åˆ—è¡¨         |
| report_column          | report_id            | æ™®é€šç´¢å¼• | æŸ¥è¯¢æŠ¥è¡¨çš„åˆ—é…ç½®           |
| report_execution_log   | report_id            | æ™®é€šç´¢å¼• | ç»Ÿè®¡æŠ¥è¡¨ä½¿ç”¨é¢‘ç‡           |
| report_execution_log   | user_id              | æ™®é€šç´¢å¼• | ç»Ÿè®¡ç”¨æˆ·ä½¿ç”¨æƒ…å†µ           |
| report_execution_log   | executed_at          | æ™®é€šç´¢å¼• | æŒ‰æ—¶é—´æŸ¥è¯¢æ—¥å¿—             |

---

## 6. æ•°æ®éœ€æ±‚åˆ†æ

### 6.1 ä¸šåŠ¡æ•°æ®ï¼ˆå¿…é¡»ï¼‰

#### 6.1.1 æŠ¥è¡¨æ‰§è¡Œæ—¥å¿—

**ç›®çš„**: å®¡è®¡ä¸åˆ†ææŠ¥è¡¨ä½¿ç”¨æƒ…å†µ

**è®°å½•å†…å®¹**:

- **è°** (user_id): æ‰§è¡ŒæŠ¥è¡¨çš„ç”¨æˆ·
- **ä»€ä¹ˆæ—¶å€™** (executed_at): æ‰§è¡Œæ—¶é—´
- **åšäº†ä»€ä¹ˆ** (report_id): æ‰§è¡Œäº†å“ªä¸ªæŠ¥è¡¨
- **æ€ä¹ˆåš** (param_values): è¾“å…¥äº†å“ªäº›å‚æ•°
- **ç»“æœå¦‚ä½•** (status, result_rows, execution_time): æˆåŠŸ/å¤±è´¥ã€è¿”å›è¡Œæ•°ã€è€—æ—¶

**åº”ç”¨åœºæ™¯**:

1. **å®¡è®¡**: è¿½æº¯è°è®¿é—®äº†æ•æ„Ÿæ•°æ®
2. **æ€§èƒ½åˆ†æ**: è¯†åˆ«æ…¢æŸ¥è¯¢ï¼ˆexecution_time > 5000msï¼‰
3. **çƒ­åº¦åˆ†æ**: ç»Ÿè®¡æœ€å¸¸ç”¨çš„æŠ¥è¡¨

**æ•°æ®ä¿ç•™ç­–ç•¥**:

- MVP: ä¿ç•™3ä¸ªæœˆ
- V2: é…ç½®åŒ–ï¼ˆ1æœˆ/3æœˆ/6æœˆ/æ°¸ä¹…ï¼‰

---

#### 6.1.2 å¯¼å‡ºè®°å½•

**ç›®çš„**: è¿½è¸ªæ•°æ®å¯¼å‡ºè¡Œä¸º

**è®°å½•å†…å®¹**ï¼ˆæ‰©å±•execution_logè¡¨ï¼‰:

```sql
ALTER TABLE report_execution_log ADD COLUMN `action_type` VARCHAR(20) COMMENT 'æ“ä½œç±»å‹ï¼šQUERY/EXPORT';
```

**åº”ç”¨åœºæ™¯**:

1. **åˆè§„å®¡è®¡**: è°å¯¼å‡ºäº†å“ªäº›æ•°æ®
2. **é…é¢ç®¡ç†**: é™åˆ¶å•ç”¨æˆ·æ¯æ—¥å¯¼å‡ºæ¬¡æ•°ï¼ˆV2ï¼‰

---

### 6.2 ç›‘æ§æ•°æ®ï¼ˆå¯é€‰ï¼ŒV2ï¼‰

#### 6.2.1 æŠ¥è¡¨ä½¿ç”¨çƒ­åº¦

**æŒ‡æ ‡**:

- æŠ¥è¡¨è®¿é—®æ¬¡æ•°ï¼ˆæŒ‰æ—¥/å‘¨/æœˆç»Ÿè®¡ï¼‰
- æ´»è·ƒç”¨æˆ·æ•°ï¼ˆå»é‡ï¼‰
- å¹³å‡æ‰§è¡Œæ—¶é—´
- å¤±è´¥ç‡

**å®ç°æ–¹å¼**:

```sql
-- ç»Ÿè®¡æŠ¥è¡¨è®¿é—®çƒ­åº¦
SELECT 
    r.name AS report_name,
    COUNT(*) AS access_count,
    COUNT(DISTINCT log.user_id) AS active_users,
    AVG(log.execution_time) AS avg_time,
    SUM(CASE WHEN log.status = 'ERROR' THEN 1 ELSE 0 END) / COUNT(*) AS error_rate
FROM report_execution_log log
JOIN report r ON log.report_id = r.id
WHERE log.executed_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY r.id
ORDER BY access_count DESC;
```

---

#### 6.2.2 æ…¢æŸ¥è¯¢ç›‘æ§

**æŒ‡æ ‡**:

- SQLæ‰§è¡Œæ—¶é—´ > 5ç§’çš„æŠ¥è¡¨
- æ…¢æŸ¥è¯¢Top 10

**å‘Šè­¦ç­–ç•¥**ï¼ˆV2ï¼‰:

```
IF execution_time > 5000ms THEN
    è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—
    é€šçŸ¥æŠ¥è¡¨åˆ›å»ºäººä¼˜åŒ–SQL
END IF
```

---

#### 6.2.3 æƒé™æ‹’ç»è®°å½•

**ç›®çš„**: å®‰å…¨å®¡è®¡

**è®°å½•å†…å®¹**:

- ç”¨æˆ·ID
- å°è¯•è®¿é—®çš„æŠ¥è¡¨ID
- æ‹’ç»æ—¶é—´
- IPåœ°å€

**åº”ç”¨åœºæ™¯**:

- è¯†åˆ«å¼‚å¸¸è®¿é—®è¡Œä¸º
- æ£€æµ‹æƒé™é…ç½®é”™è¯¯

---

### 6.3 æ•°æ®åŸ‹ç‚¹å®æ–½å»ºè®®

#### MVPé˜¶æ®µï¼ˆå¿…é¡»ï¼‰

1. âœ… æŠ¥è¡¨æ‰§è¡Œæ—¥å¿—ï¼ˆAOPåˆ‡é¢è‡ªåŠ¨è®°å½•ï¼‰

   ```java
   @Aspect
   @Component
   public class ExecutionLogAspect {
       @Around("execution(* QueryExecutorService.executeQuery(..))")
       public Object logExecution(ProceedingJoinPoint joinPoint) {
           long start = System.currentTimeMillis();
           try {
               Object result = joinPoint.proceed();
               // è®°å½•æˆåŠŸæ—¥å¿—
               saveLog(SUCCESS, System.currentTimeMillis() - start, ...);
               return result;
           } catch (Exception e) {
               // è®°å½•å¤±è´¥æ—¥å¿—
               saveLog(ERROR, System.currentTimeMillis() - start, e.getMessage());
               throw e;
           }
       }
   }
   ```
2. âœ… å¯¼å‡ºæ“ä½œè®°å½•ï¼ˆControllerå±‚æ‰‹åŠ¨è®°å½•ï¼‰

#### V2é˜¶æ®µï¼ˆå¢å¼ºï¼‰

1. â° å®šæ—¶ä»»åŠ¡ç”ŸæˆæŠ¥è¡¨ä½¿ç”¨åˆ†ææŠ¥å‘Š
2. â° Grafanaå¯è§†åŒ–çœ‹æ¿ï¼ˆæ¥å…¥Prometheusï¼‰
3. â° å‘Šè­¦é€šçŸ¥ï¼ˆæ…¢æŸ¥è¯¢/å¼‚å¸¸è®¿é—®ï¼‰

---

## 7. å®æ–½é£é™©è¯„ä¼°

### 7.1 é«˜é£é™©ï¼ˆP0 - å¿…é¡»è§£å†³ï¼‰

#### 7.1.1 SQLå®‰å…¨é£é™©

**ä¸¥é‡æ€§**: âš ï¸ é«˜

**é£é™©æè¿°**:

- ç”¨æˆ·è¾“å…¥æ¶æ„SQLå¯¼è‡´æ•°æ®æ³„éœ²æˆ–ç ´å
- ç¤ºä¾‹: `SELECT * FROM user; DROP TABLE orders; --`

**å½±å“èŒƒå›´**:

- æ•°æ®å®‰å…¨ï¼šæ•æ„Ÿæ•°æ®æ³„éœ²
- ç³»ç»Ÿç¨³å®šï¼šæ•°æ®åº“è¢«ç ´å

**ç¼“è§£æªæ–½**:

1. âœ… SQLç™½åå•æ ¡éªŒï¼ˆåªå…è®¸SELECTï¼‰
2. âœ… å…³é”®å­—é»‘åå•ï¼ˆç¦æ­¢DROP/DELETE/UPDATE/TRUNCATEï¼‰
3. âœ… åªè¯»æ•°æ®åº“è´¦å·ï¼ˆGRANT SELECT ONLYï¼‰
4. âœ… è¶…æ—¶æ§åˆ¶ï¼ˆ5ç§’å¼ºåˆ¶ä¸­æ–­ï¼‰
5. âœ… å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆPreparedStatementï¼‰

**æ®‹ç•™é£é™©**: ä½

- å¤æ‚SQLæ³¨å…¥ï¼ˆå¦‚UNIONæ³¨å…¥ï¼‰ä»å¯èƒ½ç»•è¿‡ç™½åå•
- V2å¼•å…¥SQLè§£æå™¨ï¼ˆå¦‚JSqlParserï¼‰æ·±åº¦æ ¡éªŒ

---

#### 7.1.2 æ—¶é—´å‹åŠ›å¯¼è‡´è´¨é‡é—®é¢˜

**ä¸¥é‡æ€§**: âš ï¸ é«˜

**é£é™©æè¿°**:

- 2å‘¨æ—¶é—´ç´§ï¼Œå¯èƒ½å¯¼è‡´ï¼š
  - è·³è¿‡å•å…ƒæµ‹è¯•
  - ä»£ç è´¨é‡å·®ï¼ˆæŠ€æœ¯å€ºåŠ¡ï¼‰
  - è¾¹ç•Œæƒ…å†µæœªè¦†ç›–

**å½±å“èŒƒå›´**:

- é¡¹ç›®è´¨é‡ï¼šBugå¤šï¼Œè¿”å·¥æˆæœ¬é«˜
- å›¢é˜Ÿå£«æ°”ï¼šåŠ ç­å¯¼è‡´ç–²åŠ³

**ç¼“è§£æªæ–½**:

1. âœ… æ˜ç¡®MVPèŒƒå›´ï¼Œæœæ–­ç æ‰éæ ¸å¿ƒåŠŸèƒ½
2. âœ… æ¯æ—¥ç«™ä¼šåŒæ­¥è¿›åº¦ï¼ˆ16:00ï¼Œ15åˆ†é’Ÿï¼‰
3. âœ… ä»£ç äº’å®¡ï¼ˆ2äººå›¢é˜Ÿï¼Œç›¸äº’Reviewï¼‰
4. âœ… å…³é”®æ¨¡å—ï¼ˆSQLæ‰§è¡Œã€Excelå¯¼å‡ºï¼‰å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
5. âœ… ç¬¬5å¤©ä¸­æœŸè¯„å®¡ï¼šæ£€æŸ¥æ ¸å¿ƒåŠŸèƒ½å®Œæˆåº¦

**æ®‹ç•™é£é™©**: ä¸­

- Bufferä»…20%ï¼Œçªå‘é—®é¢˜å¯èƒ½å»¶æœŸ
- å»ºè®®å‘ç®¡ç†å±‚äº‰å–å»¶é•¿åˆ°3å‘¨ï¼ˆæ›´å®‰å…¨ï¼‰

---

### 7.2 ä¸­é£é™©ï¼ˆP1 - éœ€è¦å…³æ³¨ï¼‰

#### 7.2.1 æ€§èƒ½é—®é¢˜

**ä¸¥é‡æ€§**: âš ï¸ ä¸­

**é£é™©æè¿°**:

- å¤§æ•°æ®é‡æŸ¥è¯¢/å¯¼å‡ºå¯¼è‡´å¡é¡¿
- å¹¶å‘ç”¨æˆ·å¤šæ—¶å“åº”æ…¢

**å½±å“èŒƒå›´**:

- ç”¨æˆ·ä½“éªŒï¼šç­‰å¾…æ—¶é—´é•¿ï¼Œæµå¤±ç”¨æˆ·

**ç¼“è§£æªæ–½**:

1. âœ… åˆ†é¡µæŸ¥è¯¢ï¼ˆå‰ç«¯åˆ†é¡µï¼Œæ¯é¡µ100æ¡ï¼‰
2. âœ… å¯¼å‡ºé™åˆ¶5000è¡Œ
3. âœ… SQLè¶…æ—¶5ç§’
4. âœ… æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–ï¼ˆDruidï¼‰

**V2ä¼˜åŒ–**:

- Redisç¼“å­˜æŸ¥è¯¢ç»“æœ
- å¼‚æ­¥å¯¼å‡ºå¤§æ–‡ä»¶

**æ®‹ç•™é£é™©**: ä¸­

- MVPæ— ç¼“å­˜ï¼Œç›¸åŒæŸ¥è¯¢é‡å¤æ‰§è¡Œ

---

#### 7.2.2 æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯

**ä¸¥é‡æ€§**: âš ï¸ ä¸­

**é£é™©æè¿°**:

- å¿«é€Ÿå¼€å‘å¯¼è‡´ä»£ç æ··ä¹±
- åç»­æ‰©å±•å›°éš¾

**å½±å“èŒƒå›´**:

- ç»´æŠ¤æˆæœ¬ï¼šV2é‡æ„æˆæœ¬é«˜

**ç¼“è§£æªæ–½**:

1. âœ… å‰åç«¯åˆ†ç¦»ï¼Œæ¥å£å¥‘çº¦æ˜ç¡®
2. âœ… å…³é”®Serviceç±»æ·»åŠ å•å…ƒæµ‹è¯•
3. âœ… ä»£ç æ³¨é‡Šæ¸…æ™°ï¼ˆç‰¹åˆ«æ˜¯SQLæ‰§è¡Œå¼•æ“ï¼‰
4. âœ… ç®€åŒ–æƒé™æ¨¡å‹ï¼ˆç”¨æˆ·-æŠ¥è¡¨ç›´æ¥å…³è”ï¼‰

**V2é‡æ„è®¡åˆ’**:

- æƒé™æ¨¡å‹å‡çº§ï¼ˆå¼•å…¥è§’è‰²ï¼‰ï¼š8äººæ—¥
- æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€è¿æ¥æ± ï¼‰ï¼š5äººæ—¥

**æ®‹ç•™é£é™©**: ä½

- å¯æ¥å—çš„æŠ€æœ¯å€ºåŠ¡

---

### 7.3 ä½é£é™©ï¼ˆP2 - å¯æ¥å—ï¼‰

#### 7.3.1 ç”¨æˆ·ä½“éªŒé—®é¢˜

**ä¸¥é‡æ€§**: â„¹ï¸ ä½

**é£é™©æè¿°**:

- MVPç•Œé¢ç®€é™‹
- æ“ä½œä¸å¤Ÿä¾¿æ·

**å½±å“èŒƒå›´**:

- ç”¨æˆ·æ»¡æ„åº¦ï¼šåˆæœŸç”¨æˆ·å¯èƒ½æŠ±æ€¨

**æ¥å—ç†ç”±**:

- MVPé‡åŠŸèƒ½è½»ä½“éªŒ
- V2ä¸“é—¨ä¼˜åŒ–UI/UX

---

#### 7.3.2 æ‰©å±•æ€§ä¸è¶³

**ä¸¥é‡æ€§**: â„¹ï¸ ä½

**é£é™©æè¿°**:

- æƒé™æ¨¡å‹ç®€åŒ–ï¼Œåç»­æ‰©å±•éœ€é‡æ„

**å½±å“èŒƒå›´**:

- V2å¼€å‘æˆæœ¬

**æ¥å—ç†ç”±**:

- å…ˆéªŒè¯éœ€æ±‚ï¼Œå†ä¼˜åŒ–æ¶æ„
- é‡æ„æˆæœ¬å¯æ§ï¼ˆ8äººæ—¥ï¼‰

---

### 7.4 é£é™©åº”å¯¹çŸ©é˜µ

| é£é™©        | ä¸¥é‡æ€§ | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½                   | è´£ä»»äºº     |
| ----------- | ------ | ---- | ---- | -------------------------- | ---------- |
| SQLå®‰å…¨é£é™© | é«˜     | ä¸­   | é«˜   | ç™½åå•+åªè¯»è´¦å·+è¶…æ—¶       | åç«¯è´Ÿè´£äºº |
| æ—¶é—´å‹åŠ›    | é«˜     | é«˜   | é«˜   | æ¯æ—¥ç«™ä¼š+èŒƒå›´æ§åˆ¶+äº’å®¡     | é¡¹ç›®ç»ç†   |
| æ€§èƒ½é—®é¢˜    | ä¸­     | ä¸­   | ä¸­   | åˆ†é¡µ+é™åˆ¶å¯¼å‡º+è¶…æ—¶         | åç«¯è´Ÿè´£äºº |
| æŠ€æœ¯å€ºåŠ¡    | ä¸­     | é«˜   | ä¸­   | æ¥å£å¥‘çº¦+å•å…ƒæµ‹è¯•+ä»£ç æ³¨é‡Š | å…¨å‘˜       |
| ç”¨æˆ·ä½“éªŒ    | ä½     | é«˜   | ä½   | V2ä¼˜åŒ–                     | -          |
| æ‰©å±•æ€§ä¸è¶³  | ä½     | ä¸­   | ä½   | V2é‡æ„                     | -          |

---

## 8. MVPèŒƒå›´ä¸æ’æœŸ

### 8.1 æ—¶é—´åˆ†é…

**æ€»æ—¶é—´**: 10ä¸ªå·¥ä½œæ—¥
**æ€»äººåŠ›**: 2äºº Ã— 10å¤© = 20äººæ—¥
**å¯ç”¨èµ„æº**: 16äººæ—¥æ ¸å¿ƒå¼€å‘ + 4äººæ—¥Bufferï¼ˆ20%ä½™é‡ï¼‰

---

### 8.2 è¯¦ç»†æ’æœŸ

#### ç¬¬1-2å¤©ï¼šç¯å¢ƒæ­å»ºä¸æ•°æ®åº“è®¾è®¡ âš™ï¸

**ç›®æ ‡**: æ­å»ºå¯è¿è¡Œçš„ç©ºé¡¹ç›® + æ•°æ®åº“è„šæœ¬

| å·¥ä½œå†…å®¹             | è´Ÿè´£äºº | å·¥ä½œé‡  | äº§å‡º                  |
| -------------------- | ------ | ------- | --------------------- |
| SpringBooté¡¹ç›®åˆå§‹åŒ– | å¼€å‘A  | 0.5äººæ—¥ | å¯è¿è¡Œçš„Hello World   |
| Vueé¡¹ç›®åˆå§‹åŒ–        | å¼€å‘B  | 0.5äººæ—¥ | å¯è¿è¡Œçš„Hello World   |
| æ•°æ®åº“å»ºè¡¨è„šæœ¬       | å¼€å‘A  | 1äººæ—¥   | 6å¼ è¡¨çš„DDL + æµ‹è¯•æ•°æ® |
| Element UIé›†æˆ       | å¼€å‘B  | 0.5äººæ—¥ | æ ·å¼ä¸»é¢˜é…ç½®          |
| Gitä»“åº“åˆå§‹åŒ–        | å¼€å‘A  | 0.5äººæ—¥ | ä»£ç æäº¤è§„èŒƒ          |

**æ£€æŸ¥ç‚¹**: å‰åç«¯é¡¹ç›®å¯å¯åŠ¨ï¼Œæ•°æ®åº“å¯è¿æ¥

---

#### ç¬¬3-4å¤©ï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆåç«¯ä¸»å¯¼ï¼‰ ğŸ”§

**ç›®æ ‡**: SQLæ‰§è¡Œå¼•æ“å¯ç”¨

| å·¥ä½œå†…å®¹                              | è´Ÿè´£äºº | å·¥ä½œé‡  | äº§å‡º                        |
| ------------------------------------- | ------ | ------- | --------------------------- |
| QueryExecutorServiceï¼ˆSQLæ‰§è¡Œå¼•æ“ï¼‰â­ | å¼€å‘A  | 2äººæ—¥   | å¯æ‰§è¡ŒSQL+å‚æ•°ç»‘å®š+å®‰å…¨æ ¡éªŒ |
| ReportServiceï¼ˆCRUDï¼‰                 | å¼€å‘A  | 1äººæ—¥   | æŠ¥è¡¨å¢åˆ æ”¹æŸ¥API             |
| PermissionServiceï¼ˆæƒé™æ ¡éªŒï¼‰         | å¼€å‘A  | 1äººæ—¥   | æƒé™æ‹¦æˆªå™¨+Service          |
| å‰ç«¯APIå°è£…ï¼ˆAxiosï¼‰                  | å¼€å‘B  | 0.5äººæ—¥ | ç»Ÿä¸€è¯·æ±‚å°è£…                |
| æŠ¥è¡¨åˆ—è¡¨é¡µï¼ˆè®¾è®¡ç«¯+å®¢æˆ·ç«¯ï¼‰           | å¼€å‘B  | 1.5äººæ—¥ | å±•ç¤ºæŠ¥è¡¨åˆ—è¡¨                |

**æ£€æŸ¥ç‚¹**: åç«¯å¯æ‰§è¡ŒSQLå¹¶è¿”å›ç»“æœï¼Œå‰ç«¯å¯è°ƒç”¨API

---

#### ç¬¬5-6å¤©ï¼šè®¾è®¡ç«¯å¼€å‘ï¼ˆå‰åç«¯å¹¶è¡Œï¼‰ ğŸ¨

**ç›®æ ‡**: è®¾è®¡ç«¯èƒ½åˆ›å»ºå¹¶é¢„è§ˆæŠ¥è¡¨

| å·¥ä½œå†…å®¹                        | è´Ÿè´£äºº | å·¥ä½œé‡ | äº§å‡º                       |
| ------------------------------- | ------ | ------ | -------------------------- |
| ReportDesignControllerå®Œæ•´API   | å¼€å‘A  | 1äººæ—¥  | åˆ›å»º/æ›´æ–°/æµ‹è¯•æ‰§è¡ŒAPI      |
| ReportEditor.vueï¼ˆSQLç¼–è¾‘å™¨ï¼‰â­ | å¼€å‘B  | 2äººæ—¥  | CodeMirror+å‚æ•°é…ç½®+åˆ—é…ç½® |
| æŠ¥è¡¨é¢„è§ˆåŠŸèƒ½                    | å¼€å‘B  | 1äººæ—¥  | åŠ¨æ€è¡¨æ ¼å±•ç¤º               |

**æ£€æŸ¥ç‚¹**: è®¾è®¡ç«¯å¯åˆ›å»ºæŠ¥è¡¨å¹¶é¢„è§ˆæ•°æ®

**ä¸­æœŸè¯„å®¡**:

- æ£€æŸ¥SQLæ‰§è¡Œå¼•æ“ç¨³å®šæ€§
- æ£€æŸ¥æŠ¥è¡¨ç¼–è¾‘å™¨å¯ç”¨æ€§
- é£é™©è¯†åˆ«ä¸è°ƒæ•´

---

#### ç¬¬7-8å¤©ï¼šå®¢æˆ·ç«¯ä¸å¯¼å‡ºï¼ˆå‰åç«¯å¹¶è¡Œï¼‰ ğŸ“Š

**ç›®æ ‡**: å®Œæ•´åŠŸèƒ½æµç¨‹å¯ç”¨

| å·¥ä½œå†…å®¹                          | è´Ÿè´£äºº | å·¥ä½œé‡ | äº§å‡º                   |
| --------------------------------- | ------ | ------ | ---------------------- |
| ExportServiceï¼ˆExcelå¯¼å‡ºï¼‰â­      | å¼€å‘A  | 1äººæ—¥  | POIç”ŸæˆExcel           |
| ReportViewerController API        | å¼€å‘A  | 1äººæ—¥  | å®¢æˆ·ç«¯æŸ¥è¯¢/å¯¼å‡ºAPI     |
| ReportViewer.vueï¼ˆæŠ¥è¡¨æŸ¥çœ‹ï¼‰      | å¼€å‘B  | 1äººæ—¥  | å‚æ•°è¾“å…¥+æŸ¥çœ‹+å¯¼å‡ºæŒ‰é’® |
| PermissionManager.vueï¼ˆæƒé™åˆ†é…ï¼‰ | å¼€å‘B  | 1äººæ—¥  | ç”¨æˆ·é€‰æ‹©+æƒé™ä¿å­˜      |

**æ£€æŸ¥ç‚¹**: å®Œæ•´æµç¨‹å¯è·‘é€šï¼ˆè®¾è®¡â†’æˆæƒâ†’æŸ¥çœ‹â†’å¯¼å‡ºï¼‰

---

#### ç¬¬9-10å¤©ï¼šæµ‹è¯•ä¸ä¿®å¤ ğŸ›

**ç›®æ ‡**: å¯æ¼”ç¤ºçš„MVP

| å·¥ä½œå†…å®¹                     | è´Ÿè´£äºº | å·¥ä½œé‡  | äº§å‡º                        |
| ---------------------------- | ------ | ------- | --------------------------- |
| åŠŸèƒ½æµ‹è¯•ï¼ˆæ‰‹å·¥æµ‹è¯•æ ¸å¿ƒæµç¨‹ï¼‰ | å…¨å‘˜   | 1äººæ—¥   | Bugæ¸…å•                     |
| Bugä¿®å¤                      | å…¨å‘˜   | 2äººæ—¥   | ç¨³å®šç‰ˆæœ¬                    |
| å•å…ƒæµ‹è¯•ï¼ˆå…³é”®æ¨¡å—ï¼‰         | å¼€å‘A  | 0.5äººæ—¥ | SQLæ‰§è¡Œå¼•æ“+å¯¼å‡ºServiceæµ‹è¯• |
| ç®€å•éƒ¨ç½²æ–‡æ¡£                 | å¼€å‘A  | 0.5äººæ—¥ | README + éƒ¨ç½²æ­¥éª¤           |

**æ£€æŸ¥ç‚¹**: æ— P0/P1çº§åˆ«Bugï¼Œå¯æ¼”ç¤ºç»™éœ€æ±‚æ–¹

**æ¼”ç¤ºå†…å®¹**:

1. è®¾è®¡ç«¯åˆ›å»ºæŠ¥è¡¨
2. åˆ†é…æƒé™
3. å®¢æˆ·ç«¯æŸ¥çœ‹æŠ¥è¡¨
4. å¯¼å‡ºExcel

---

### 8.3 MVPåŠŸèƒ½æ¸…å•

#### âœ… å¿…é¡»åŒ…å«ï¼ˆMust Haveï¼‰

1. **è®¾è®¡ç«¯**:

   - [ ] åˆ›å»ºæŠ¥è¡¨ï¼ˆSQL+å‚æ•°+åˆ—é…ç½®ï¼‰
   - [ ] æµ‹è¯•æ‰§è¡ŒSQLï¼Œé¢„è§ˆç»“æœ
   - [ ] åˆ†é…æƒé™ï¼ˆé€‰æ‹©ç”¨æˆ·ï¼‰
   - [ ] æŠ¥è¡¨åˆ—è¡¨ï¼ˆæŸ¥çœ‹/ç¼–è¾‘/åˆ é™¤ï¼‰
2. **å®¢æˆ·ç«¯**:

   - [ ] æŸ¥çœ‹æˆ‘çš„æŠ¥è¡¨ï¼ˆæœ‰æƒé™çš„ï¼‰
   - [ ] è¾“å…¥å‚æ•°å¹¶æŸ¥è¯¢
   - [ ] åˆ†é¡µå±•ç¤ºç»“æœ
   - [ ] å¯¼å‡ºExcelï¼ˆé™åˆ¶5000è¡Œï¼‰
3. **å®‰å…¨**:

   - [ ] SQLå®‰å…¨æ ¡éªŒï¼ˆåªå…è®¸SELECTï¼‰
   - [ ] æƒé™æ‹¦æˆªå™¨ï¼ˆæ— æƒé™è¿”å›403ï¼‰
   - [ ] ç”¨æˆ·ç™»å½•/ç™»å‡º

---

#### âŒ æ˜ç¡®æ’é™¤ï¼ˆNot in MVPï¼‰

1. âŒ å¤æ‚æƒé™ï¼ˆè§’è‰²ã€ç»„ç»‡æ¶æ„ï¼‰
2. âŒ æŠ¥è¡¨æ ·å¼ç¾åŒ–
3. âŒ å›¾è¡¨æ”¯æŒï¼ˆæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ï¼‰
4. âŒ å®šæ—¶ä»»åŠ¡
5. âŒ æŠ¥è¡¨åˆ†ç»„/æ ‡ç­¾
6. âŒ æ“ä½œå®¡è®¡çœ‹æ¿ï¼ˆåªè®°å½•ä¸å±•ç¤ºï¼‰
7. âŒ å‚æ•°è”åŠ¨ï¼ˆçœå¸‚åŒºçº§è”ï¼‰
8. âŒ æŠ¥è¡¨ç‰ˆæœ¬ç®¡ç†
9. âŒ å¤šæ•°æ®æºæ”¯æŒ
10. âŒ æŠ¥è¡¨æ¨¡æ¿å¸‚åœº

---

### 8.4 äººåŠ›åˆ†é…å»ºè®®

| å¼€å‘äººå‘˜ | ä¸»è¦èŒè´£                         | å æ¯”    |
| -------- | -------------------------------- | ------- |
| å¼€å‘A    | åç«¯æ¶æ„ã€SQLæ‰§è¡Œå¼•æ“ã€Excelå¯¼å‡º | 60%åç«¯ |
| å¼€å‘B    | å‰ç«¯æ¶æ„ã€æŠ¥è¡¨ç¼–è¾‘å™¨ã€å®¢æˆ·ç«¯     | 80%å‰ç«¯ |

**åä½œæ¨¡å—**:

- æ¥å£å®šä¹‰ï¼šå…±åŒè®¨è®ºï¼ˆç¬¬1å¤©ï¼‰
- æƒé™åŠŸèƒ½ï¼šåç«¯å®ç°æ‹¦æˆªå™¨ï¼Œå‰ç«¯å®ç°æƒé™åˆ†é…é¡µé¢
- è”è°ƒæµ‹è¯•ï¼šç¬¬8å¤©é›†æˆæµ‹è¯•

---

### 8.5 é‡Œç¨‹ç¢‘ä¸äº¤ä»˜ç‰©

| é‡Œç¨‹ç¢‘           | æ—¶é—´ç‚¹ | äº¤ä»˜ç‰©               | éªŒæ”¶æ ‡å‡†                 |
| ---------------- | ------ | -------------------- | ------------------------ |
| M1: ç¯å¢ƒå°±ç»ª     | Day 2  | ç©ºé¡¹ç›®+æ•°æ®åº“è„šæœ¬    | é¡¹ç›®å¯å¯åŠ¨ï¼Œæ•°æ®åº“å¯è¿æ¥ |
| M2: æ ¸å¿ƒå¼•æ“å®Œæˆ | Day 4  | SQLæ‰§è¡Œå¼•æ“+æŠ¥è¡¨CRUD | å¯æ‰§è¡ŒSQLå¹¶è¿”å›ç»“æœ      |
| M3: è®¾è®¡ç«¯å®Œæˆ   | Day 6  | æŠ¥è¡¨ç¼–è¾‘å™¨+é¢„è§ˆ      | å¯åˆ›å»ºæŠ¥è¡¨å¹¶é¢„è§ˆæ•°æ®     |
| M4: å®Œæ•´æµç¨‹æ‰“é€š | Day 8  | å®¢æˆ·ç«¯+å¯¼å‡º          | å®Œæ•´æµç¨‹å¯æ¼”ç¤º           |
| M5: MVPäº¤ä»˜      | Day 10 | ç¨³å®šç‰ˆæœ¬+éƒ¨ç½²æ–‡æ¡£    | æ— P0/P1 Bugï¼Œå¯éƒ¨ç½²      |

---

## 9. éªŒæ”¶æ ‡å‡†

### 9.1 åŠŸèƒ½éªŒæ”¶æ ‡å‡†ï¼ˆMust Haveï¼‰

#### 9.1.1 ç®¡ç†ç«¯åŠŸèƒ½ (ADMIN) âœ…

- [ ] **ç”¨æˆ·ç®¡ç†**: å¯åˆ›å»ºã€ç¼–è¾‘ã€ç¦ç”¨/å¯ç”¨ç”¨æˆ·
- [ ] **è§’è‰²åˆ†é…**: å¯ä¸ºç”¨æˆ·åˆ†é…è§’è‰²ï¼ˆADMIN/DESIGNER/VIEWERï¼‰
- [ ] **ç”¨æˆ·æœç´¢**: å¯æŒ‰ç”¨æˆ·åæˆ–çœŸå®å§“åæœç´¢ç”¨æˆ·
- [ ] **è§’è‰²æŸ¥çœ‹**: å¯æŸ¥çœ‹ç³»ç»Ÿå†…ç½®ä¸‰ä¸ªè§’è‰²åŠå…¶æƒé™è¯´æ˜
- [ ] **å…¨å±€æµè§ˆ**: å¯æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰æŠ¥è¡¨ï¼ˆä¸å—æƒé™é™åˆ¶ï¼‰
- [ ] **æ‰¹é‡æ“ä½œ**: å¯æ‰¹é‡ä¸ºå¤šä¸ªç”¨æˆ·åˆ†é…è§’è‰²

---

#### 9.1.2 è®¾è®¡ç«¯åŠŸèƒ½ (DESIGNER) âœ…

- [ ] **åˆ›å»ºæŠ¥è¡¨**: å¯åˆ›å»ºæŠ¥è¡¨ï¼Œå¡«å†™åç§°ã€æè¿°ã€SQL
- [ ] **SQLç¼–è¾‘**: SQLç¼–è¾‘å™¨æœ‰è¯­æ³•é«˜äº®ï¼Œæ”¯æŒå¤šè¡Œè¾“å…¥
- [ ] **å‚æ•°é…ç½®**: å¯æ·»åŠ å‚æ•°ï¼Œé…ç½®å‚æ•°åã€ç±»å‹ï¼ˆå­—ç¬¦ä¸²/æ•°å­—/æ—¥æœŸï¼‰ã€é»˜è®¤å€¼ã€æ˜¯å¦å¿…å¡«
- [ ] **å‚æ•°å ä½ç¬¦**: SQLæ¨¡æ¿æ”¯æŒ `#{paramName}` å ä½ç¬¦æ ¼å¼
- [ ] **åˆ—é…ç½®**: å¯é…ç½®å­—æ®µåã€æ˜¾ç¤ºåç§°ã€åˆ—å®½
- [ ] **æµ‹è¯•æ‰§è¡Œï¼ˆæŠ¥è¡¨é¢„è§ˆï¼‰**: ç‚¹å‡»"æµ‹è¯•æ‰§è¡Œ"æŒ‰é’®ï¼Œè¾“å…¥å‚æ•°å€¼ï¼Œèƒ½é¢„è§ˆæŸ¥è¯¢ç»“æœï¼ˆè‡³å°‘æ˜¾ç¤ºå‰100è¡Œï¼‰
- [ ] **è°ƒè¯•æ”¯æŒ**: å¯å¤šæ¬¡æ‰§è¡Œæµ‹è¯•ï¼ŒéªŒè¯SQLå’Œå‚æ•°é…ç½®çš„æ­£ç¡®æ€§
- [ ] **ä¿å­˜æŠ¥è¡¨**: ä¿å­˜åç”ŸæˆæŠ¥è¡¨IDï¼Œå¯åœ¨æŠ¥è¡¨åˆ—è¡¨ä¸­æŸ¥çœ‹
- [ ] **è§’è‰²æˆæƒ**: å¯ä¸ºæŠ¥è¡¨åˆ†é…è§’è‰²æƒé™ï¼ˆVIEWER/DESIGNERï¼‰
- [ ] **æƒé™å±•ç¤º**: æ˜¾ç¤ºå·²æˆæƒè§’è‰²åˆ—è¡¨
- [ ] **å–æ¶ˆæƒé™**: å¯å–æ¶ˆå·²æˆæƒè§’è‰²çš„æƒé™

---

#### 9.1.3 ç”¨æˆ·ç«¯åŠŸèƒ½ (VIEWER) - æŠ¥è¡¨æŸ¥è¯¢ âœ…

- [ ] **æƒé™è¿‡æ»¤**: å®¢æˆ·ç«¯åªæ˜¾ç¤ºå½“å‰ç”¨æˆ·è§’è‰²æœ‰æƒé™çš„æŠ¥è¡¨åˆ—è¡¨
- [ ] **æ— æƒé™æç¤º**: è®¿é—®æ— æƒé™æŠ¥è¡¨æ—¶è¿”å›403é”™è¯¯ï¼Œå‰ç«¯å‹å¥½æç¤º
- [ ] **æŠ¥è¡¨åˆ—è¡¨**: å±•ç¤ºå·²æˆæƒçš„æŠ¥è¡¨åˆ—è¡¨ï¼ˆåŒ…å«æŠ¥è¡¨åç§°ã€æè¿°ã€åˆ›å»ºæ—¶é—´ï¼‰
- [ ] **æŠ¥è¡¨æœç´¢**: å¯æŒ‰æŠ¥è¡¨åç§°æœç´¢
- [ ] **æŠ¥è¡¨è¯¦æƒ…**: ç‚¹å‡»æŠ¥è¡¨è¿›å…¥æŸ¥è¯¢é¡µï¼Œæ˜¾ç¤ºæŠ¥è¡¨åç§°å’Œæè¿°
- [ ] **å‚æ•°è¡¨å•**: è‡ªåŠ¨æ˜¾ç¤ºå‚æ•°è¾“å…¥è¡¨å•ï¼ˆæ ¹æ®å‚æ•°å®šä¹‰ç”Ÿæˆï¼‰
- [ ] **å‚æ•°æ ¡éªŒ**: å¿…å¡«å‚æ•°æœªå¡«å†™æ—¶ï¼Œç‚¹å‡»"æŸ¥è¯¢"æŒ‰é’®æç¤ºç”¨æˆ·
- [ ] **æ‰§è¡ŒæŸ¥è¯¢**: ç‚¹å‡»"æŸ¥è¯¢"æŒ‰é’®åæ‰§è¡ŒSQLï¼Œå±•ç¤ºæŸ¥è¯¢ç»“æœ
- [ ] **æ•°æ®å±•ç¤º**: æŸ¥è¯¢åå±•ç¤ºæ•°æ®è¡¨æ ¼ï¼Œåˆ—åæ˜¾ç¤ºä¸ºé…ç½®çš„"æ˜¾ç¤ºåç§°"
- [ ] **åˆ†é¡µåŠŸèƒ½**: è¡¨æ ¼æ”¯æŒåˆ†é¡µï¼ˆæ¯é¡µ100æ¡ï¼‰ï¼Œæ˜¾ç¤ºæ€»è¡Œæ•°
- [ ] **åˆ—æ’åº**: å¯ç‚¹å‡»åˆ—å¤´æ’åºï¼ˆå‰ç«¯æ’åºï¼‰

---

#### 9.1.4 Excelå¯¼å‡ºåŠŸèƒ½ âœ…

- [ ] **å¯¼å‡ºæŒ‰é’®**: æŸ¥è¯¢ç»“æœé¡µæœ‰"å¯¼å‡ºExcel"æŒ‰é’®ï¼Œä½ç½®æ˜æ˜¾
- [ ] **æ–‡ä»¶ç”Ÿæˆ**: ç‚¹å‡»åä¸‹è½½Excelæ–‡ä»¶
- [ ] **æ–‡ä»¶å‘½å**: æ–‡ä»¶åæ ¼å¼: `æŠ¥è¡¨å_YYYYMMDD_HHmmss.xlsx`
- [ ] **å†…å®¹æ­£ç¡®**: ExcelåŒ…å«è¡¨å¤´ï¼ˆæ˜¾ç¤ºåç§°ï¼‰å’Œæ•°æ®è¡Œ
- [ ] **æ ¼å¼åŒ–**: æ—¥æœŸç±»å‹æ ¼å¼åŒ–ä¸º `YYYY-MM-DD`ï¼Œæ•°å­—ç±»å‹å³å¯¹é½
- [ ] **è¡Œæ•°é™åˆ¶**: è¶…è¿‡5000è¡Œæ—¶å‰ç«¯æç¤º"æ•°æ®é‡è¿‡å¤§ï¼Œè¯·æ·»åŠ ç­›é€‰æ¡ä»¶"ï¼Œä¸æ‰§è¡Œå¯¼å‡º
- [ ] **åˆ—å®½è‡ªé€‚åº”**: åˆ—å®½æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´ï¼ˆæˆ–ä½¿ç”¨é…ç½®çš„å›ºå®šå®½åº¦ï¼‰

---

#### 9.1.5 RBACæƒé™éªŒè¯ âœ…

- [ ] **è§’è‰²æƒé™**: ADMINå¯è®¿é—®æ‰€æœ‰æŠ¥è¡¨ï¼ŒDESIGNER/VIEWERä»…èƒ½è®¿é—®å·²æˆæƒæŠ¥è¡¨
- [ ] **æƒé™ç»§æ‰¿**: ADMINå…·æœ‰æœ€é«˜æƒé™ï¼Œè‡ªåŠ¨åŒ…å«DESIGNERå’ŒVIEWERçš„æ‰€æœ‰æƒé™
- [ ] **æƒé™æ‹¦æˆª**: ç”¨æˆ·è®¿é—®æ— æƒé™æŠ¥è¡¨æ—¶è¿”å›403ï¼Œä¸æ‰§è¡ŒSQL
- [ ] **ç™»å½•æ ¡éªŒ**: æœªç™»å½•ç”¨æˆ·è®¿é—®ä»»ä½•APIæ—¶è·³è½¬åˆ°ç™»å½•é¡µ
- [ ] **è§’è‰²ç¼“å­˜**: ç”¨æˆ·è§’è‰²ä¿¡æ¯è¢«ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ï¼ˆç¼“å­˜TTL=5åˆ†é’Ÿï¼‰

---

#### 9.1.6 å®‰å…¨æ€§éªŒæ”¶ âœ…

- [ ] **SQLç™½åå•**: è¾“å…¥éSELECTè¯­å¥ï¼ˆå¦‚UPDATE/DELETEï¼‰æ—¶ï¼Œä¿å­˜æŠ¥è¡¨å¤±è´¥ï¼Œæç¤º"ä»…æ”¯æŒSELECTæŸ¥è¯¢"
- [ ] **å…³é”®å­—é»‘åå•**: SQLåŒ…å«DROP/TRUNCATEç­‰å±é™©å…³é”®å­—æ—¶æ‹’ç»ä¿å­˜
- [ ] **SQLè¶…æ—¶**: æ‰§è¡Œè¶…è¿‡5ç§’çš„SQLè‡ªåŠ¨ä¸­æ–­ï¼Œè¿”å›è¶…æ—¶é”™è¯¯
- [ ] **åªè¯»è´¦å·**: æ•°æ®åº“è¿æ¥ä½¿ç”¨åªè¯»è´¦å·ï¼ˆé€šè¿‡ `SHOW GRANTS FOR 'report_readonly'` éªŒè¯ï¼‰

---

### 9.2 æ€§èƒ½éªŒæ”¶æ ‡å‡†ï¼ˆShould Haveï¼‰

- [ ] **å°æ•°æ®é‡æŸ¥è¯¢**: 1000è¡Œæ•°æ®æŸ¥è¯¢å“åº”æ—¶é—´ < 3ç§’
- [ ] **å¯¼å‡ºæ€§èƒ½**: å¯¼å‡º1000è¡ŒExcelè€—æ—¶ < 5ç§’
- [ ] **æŠ¥è¡¨åˆ—è¡¨åŠ è½½**: åˆ—è¡¨é¡µåŠ è½½æ—¶é—´ < 1ç§’
- [ ] **å¹¶å‘æ€§èƒ½**: 5ä¸ªç”¨æˆ·åŒæ—¶æŸ¥è¯¢ä¸åŒæŠ¥è¡¨ï¼Œæ— é˜»å¡ï¼ˆå‹æµ‹ï¼‰

---

### 9.3 å…¼å®¹æ€§éªŒæ”¶ï¼ˆShould Haveï¼‰

- [ ] **æµè§ˆå™¨å…¼å®¹**: Chromeæœ€æ–°ç‰ˆã€Edgeæœ€æ–°ç‰ˆæ­£å¸¸è¿è¡Œ
- [ ] **åˆ†è¾¨ç‡é€‚é…**: æ”¯æŒ1920x1080ã€1366x768åˆ†è¾¨ç‡
- [ ] **æ•°æ®åº“ç‰ˆæœ¬**: åç«¯å…¼å®¹MySQL 5.7+ å’Œ MySQL 8.0+

---

### 9.4 æ–‡æ¡£éªŒæ”¶ï¼ˆMust Haveï¼‰

- [ ] **éƒ¨ç½²æ–‡æ¡£**: åŒ…å«æ•°æ®åº“è„šæœ¬ã€é…ç½®æ–‡ä»¶è¯´æ˜ã€å¯åŠ¨æ­¥éª¤
- [ ] **ç”¨æˆ·æ‰‹å†Œ**:
  - è®¾è®¡ç«¯æ“ä½œæµç¨‹ï¼ˆåˆ›å»ºæŠ¥è¡¨â†’åˆ†é…æƒé™ï¼‰
  - å®¢æˆ·ç«¯æ“ä½œæµç¨‹ï¼ˆæŸ¥çœ‹æŠ¥è¡¨â†’å¯¼å‡ºExcelï¼‰
  - å¸¸è§é—®é¢˜FAQ
- [ ] **APIæ–‡æ¡£**: Swaggeræˆ–Markdownæ ¼å¼çš„æ¥å£æ–‡æ¡£

---

### 9.5 æµ‹è¯•ç”¨ä¾‹ï¼ˆSampleï¼‰

#### æµ‹è¯•ç”¨ä¾‹1: åˆ›å»ºæŠ¥è¡¨å¹¶é¢„è§ˆ

1. ç™»å½•è®¾è®¡ç«¯ï¼ˆadminè´¦å·ï¼‰
2. ç‚¹å‡»"åˆ›å»ºæŠ¥è¡¨"
3. å¡«å†™æŠ¥è¡¨åç§°ï¼š"ç”¨æˆ·åˆ—è¡¨"
4. å¡«å†™SQL: `SELECT id, username, real_name FROM user WHERE role = #{role}`
5. æ·»åŠ å‚æ•°: `role`, ç±»å‹ `STRING`, é»˜è®¤å€¼ `USER`, å¿…å¡«
6. ç‚¹å‡»"æµ‹è¯•æ‰§è¡Œ"ï¼Œè¾“å…¥role=`ADMIN`
7. **é¢„æœŸç»“æœ**: æ˜¾ç¤ºæ‰€æœ‰ç®¡ç†å‘˜ç”¨æˆ·ï¼Œè‡ªåŠ¨æå–åˆ—é…ç½®ï¼ˆid/username/real_nameï¼‰
8. ä¿®æ”¹æ˜¾ç¤ºåç§°ï¼šidâ†’ç”¨æˆ·ID, usernameâ†’ç”¨æˆ·å, real_nameâ†’å§“å
9. ç‚¹å‡»"ä¿å­˜"
10. **é¢„æœŸç»“æœ**: ä¿å­˜æˆåŠŸï¼Œè·³è½¬åˆ°æŠ¥è¡¨åˆ—è¡¨

---

#### æµ‹è¯•ç”¨ä¾‹2: æƒé™åˆ†é…ä¸è®¿é—®æ§åˆ¶

1. è®¾è®¡ç«¯ï¼Œé€‰æ‹©"ç”¨æˆ·åˆ—è¡¨"æŠ¥è¡¨ï¼Œç‚¹å‡»"æƒé™è®¾ç½®"
2. æœç´¢ç”¨æˆ· `user1`ï¼Œå‹¾é€‰å¹¶ç‚¹å‡»"æˆæƒ"
3. **é¢„æœŸç»“æœ**: æƒé™ä¿å­˜æˆåŠŸï¼Œæ˜¾ç¤ºåœ¨å·²æˆæƒåˆ—è¡¨ä¸­
4. åˆ‡æ¢åˆ°å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ `user1` è´¦å·ç™»å½•
5. **é¢„æœŸç»“æœ**: å¯ä»¥çœ‹åˆ°"ç”¨æˆ·åˆ—è¡¨"æŠ¥è¡¨
6. ä½¿ç”¨ `user2` è´¦å·ç™»å½•ï¼ˆæœªæˆæƒï¼‰
7. **é¢„æœŸç»“æœ**: ä¸æ˜¾ç¤º"ç”¨æˆ·åˆ—è¡¨"æŠ¥è¡¨
8. æ‰‹åŠ¨è®¿é—® `/api/reports/1/execute`
9. **é¢„æœŸç»“æœ**: è¿”å›403é”™è¯¯ï¼Œæç¤º"æ— æƒé™è®¿é—®æ­¤æŠ¥è¡¨"

---

#### æµ‹è¯•ç”¨ä¾‹3: Excelå¯¼å‡º

1. å®¢æˆ·ç«¯ï¼Œæ‰“å¼€"ç”¨æˆ·åˆ—è¡¨"æŠ¥è¡¨
2. è¾“å…¥å‚æ•° role=`USER`ï¼Œç‚¹å‡»"æŸ¥è¯¢"
3. **é¢„æœŸç»“æœ**: æ˜¾ç¤ºæ‰€æœ‰æ™®é€šç”¨æˆ·ï¼ˆå‡è®¾10æ¡ï¼‰
4. ç‚¹å‡»"å¯¼å‡ºExcel"
5. **é¢„æœŸç»“æœ**: ä¸‹è½½æ–‡ä»¶ `ç”¨æˆ·åˆ—è¡¨_20251226_103000.xlsx`
6. æ‰“å¼€Excelæ–‡ä»¶
7. **é¢„æœŸç»“æœ**:
   - è¡¨å¤´ï¼šç”¨æˆ·ID | ç”¨æˆ·å | å§“å
   - æ•°æ®è¡Œï¼š10è¡Œç”¨æˆ·æ•°æ®
   - åˆ—å®½è‡ªé€‚åº”

---

### 9.6 éªŒæ”¶é€šè¿‡æ ‡å‡†

**P0çº§åˆ«ï¼ˆé˜»å¡å‘å¸ƒï¼‰**:

- âœ… æ‰€æœ‰"åŠŸèƒ½éªŒæ”¶æ ‡å‡†"é€šè¿‡
- âœ… æ‰€æœ‰"å®‰å…¨æ€§éªŒæ”¶"é€šè¿‡
- âœ… æ— P0çº§åˆ«Bugï¼ˆæ•°æ®ä¸¢å¤±ã€ç³»ç»Ÿå´©æºƒã€SQLæ³¨å…¥ï¼‰

**P1çº§åˆ«ï¼ˆå…è®¸å»¶åä¿®å¤ï¼‰**:

- âš ï¸ æ€§èƒ½éªŒæ”¶æ ‡å‡†éƒ¨åˆ†æœªè¾¾æ ‡ï¼ˆå¦‚3ç§’å†…æŸ¥è¯¢å˜æˆ5ç§’ï¼‰
- âš ï¸ å…¼å®¹æ€§é—®é¢˜ï¼ˆå¦‚Firefoxæµè§ˆå™¨å¸ƒå±€é”™ä½ï¼‰
- âš ï¸ P1çº§åˆ«Bugï¼ˆåŠŸèƒ½å¯ç”¨ä½†ä½“éªŒå·®ï¼‰

---

## 10. ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### 10.1 ç«‹å³è¡ŒåŠ¨ï¼ˆç¬¬1å¤©å¼€å§‹å‰ï¼‰ ğŸš€

#### è¡ŒåŠ¨1: æŠ€æœ¯æ ˆç¡®è®¤ä¸ç¯å¢ƒå‡†å¤‡

**ç›®æ ‡**: ç¡®ä¿å¼€å‘ç¯å¢ƒä¸€è‡´

**ä»»åŠ¡æ¸…å•**:

- [ ] ç¡®è®¤å¼€å‘ç¯å¢ƒç‰ˆæœ¬:
  - JDK: 11æˆ–17
  - Node.js: 16+
  - MySQL: 5.7æˆ–8.0
  - Maven: 3.6+
  - Git: æœ€æ–°ç‰ˆ
- [ ] å‡†å¤‡æµ‹è¯•æ•°æ®åº“
  - è‡³å°‘1ä¸ªæœ‰æ•°æ®çš„ä¸šåŠ¡è¡¨ï¼ˆç”¨äºæ¼”ç¤ºæŸ¥è¯¢ï¼‰
  - ç¤ºä¾‹: `orders`è¡¨ï¼ˆè®¢å•è¡¨ï¼Œå«æ—¥æœŸã€é‡‘é¢å­—æ®µï¼‰
- [ ] ç¡®è®¤ä»£ç ä»“åº“
  - Gitä»“åº“åœ°å€
  - åˆ†æ”¯ç­–ç•¥ï¼ˆmain + developï¼‰
  - Commitè§„èŒƒï¼ˆfeat/fix/docsï¼‰

**è´£ä»»äºº**: æŠ€æœ¯è´Ÿè´£äºº
**å®Œæˆæ—¶é—´**: 2å°æ—¶
**éªŒæ”¶æ ‡å‡†**: ä¸¤ä½å¼€å‘ç¯å¢ƒç‰ˆæœ¬ä¸€è‡´ï¼Œæ•°æ®åº“å¯è¿æ¥

---

#### è¡ŒåŠ¨2: å›¢é˜Ÿåˆ†å·¥æ˜ç¡®

**ç›®æ ‡**: æ¸…æ™°çš„è§’è‰²èŒè´£

**å»ºè®®åˆ†å·¥**:

```
å¼€å‘Aï¼ˆåç«¯ä¸»åŠ›ï¼‰:
- è´Ÿè´£: SQLæ‰§è¡Œå¼•æ“ã€æƒé™æ‹¦æˆªå™¨ã€Excelå¯¼å‡º
- æŠ€èƒ½è¦æ±‚: ç†Ÿæ‚‰SpringBootã€JPAã€POI
- å…³é”®äº§å‡º: QueryExecutorService, ExportService

å¼€å‘Bï¼ˆå‰ç«¯ä¸»åŠ›ï¼‰:
- è´Ÿè´£: æŠ¥è¡¨ç¼–è¾‘å™¨ã€é¢„è§ˆã€å®¢æˆ·ç«¯é¡µé¢
- æŠ€èƒ½è¦æ±‚: ç†Ÿæ‚‰Vueã€Element UIã€CodeMirror
- å…³é”®äº§å‡º: ReportEditor.vue, ReportViewer.vue

å…³é”®æ¨¡å—ï¼ˆç»“å¯¹ç¼–ç¨‹ï¼‰:
- SQLæ‰§è¡Œå¼•æ“ï¼ˆDay 3-4ï¼‰: ä¸¤äººåä½œï¼Œç¡®ä¿å®‰å…¨æ€§
- æƒé™åŠŸèƒ½ï¼ˆDay 7ï¼‰: å‰åç«¯è”è°ƒ
```

**è´£ä»»äºº**: é¡¹ç›®ç»ç†
**å®Œæˆæ—¶é—´**: 1å°æ—¶
**éªŒæ”¶æ ‡å‡†**: åˆ†å·¥æ–‡æ¡£ï¼ˆMarkdownï¼‰ï¼ŒåŒæ–¹ç¡®è®¤

---

#### è¡ŒåŠ¨3: åŸå‹ç¡®è®¤

**ç›®æ ‡**: ä¸éœ€æ±‚æ–¹å¯¹é½é¢„æœŸ

**ä»»åŠ¡æ¸…å•**:

- [ ] ç”»å‡ºè®¾è®¡ç«¯å’Œå®¢æˆ·ç«¯çš„é¡µé¢è‰å›¾ï¼ˆæ‰‹ç»˜æˆ–Axureï¼‰
  - è®¾è®¡ç«¯: æŠ¥è¡¨åˆ—è¡¨é¡µã€æŠ¥è¡¨ç¼–è¾‘å™¨é¡µ
  - å®¢æˆ·ç«¯: æˆ‘çš„æŠ¥è¡¨é¡µã€æŠ¥è¡¨æŸ¥çœ‹å™¨é¡µ
- [ ] ä¸éœ€æ±‚æ–¹ç¡®è®¤æ ¸å¿ƒæµç¨‹
  - æ¼”ç¤ºç«å“ï¼ˆå¸†è½¯ã€æ¶¦ä¹¾ï¼‰çš„æ ¸å¿ƒåŠŸèƒ½
  - æ˜ç¡®å“ªäº›åŠŸèƒ½æ˜¯MVPå¿…é¡»ï¼Œå“ªäº›å¯å»¶æœŸ
- [ ] ç¡®è®¤æ•°æ®æº
  - è¿æ¥å“ªä¸ªä¸šåŠ¡æ•°æ®åº“ï¼Ÿ
  - æœ‰å“ªäº›å¸¸ç”¨æŸ¥è¯¢åœºæ™¯ï¼Ÿï¼ˆç”¨äºæµ‹è¯•ï¼‰

**è´£ä»»äºº**: äº§å“/éœ€æ±‚æ–¹
**å®Œæˆæ—¶é—´**: 4å°æ—¶
**éªŒæ”¶æ ‡å‡†**: åŸå‹å›¾+åŠŸèƒ½æ¸…å•ï¼ŒåŒæ–¹ç­¾å­—ç¡®è®¤

---

### 10.2 ç¬¬1å¤©è¡ŒåŠ¨ï¼ˆå¼€å‘å¯åŠ¨ï¼‰ ğŸ› ï¸

#### è¡ŒåŠ¨4: æ•°æ®åº“è®¾è®¡è¯„å®¡

**ä»»åŠ¡æ¸…å•**:

- [ ] æ ¹æ®ç¬¬5ç« è¡¨ç»“æ„åˆ›å»ºDDLè„šæœ¬
- [ ] å›¢é˜Ÿè¯„å®¡è¡¨è®¾è®¡
  - å­—æ®µç±»å‹æ˜¯å¦åˆç†ï¼Ÿï¼ˆå¦‚JSONå­—æ®µå…¼å®¹æ€§ï¼‰
  - ç´¢å¼•æ˜¯å¦å……åˆ†ï¼Ÿï¼ˆè”åˆç´¢å¼•é¡ºåºï¼‰
  - å¤–é”®çº¦æŸæ˜¯å¦éœ€è¦ï¼Ÿï¼ˆON DELETE CASCADEï¼‰
- [ ] æ‰§è¡Œå»ºè¡¨è„šæœ¬ï¼Œæ’å…¥æµ‹è¯•æ•°æ®
  - è‡³å°‘3ä¸ªæŠ¥è¡¨
  - è‡³å°‘5ä¸ªç”¨æˆ·
  - æƒé™å…³ç³»è¦†ç›–å„ç§åœºæ™¯

**è´£ä»»äºº**: å¼€å‘A
**å®Œæˆæ—¶é—´**: åŠå¤©
**äº§å‡º**: `schema.sql` + `data.sql`
**éªŒæ”¶æ ‡å‡†**: æ•°æ®åº“å¯æŸ¥è¯¢ï¼Œå¤–é”®çº¦æŸæ­£å¸¸

---

#### è¡ŒåŠ¨5: APIå¥‘çº¦å®šä¹‰

**ä»»åŠ¡æ¸…å•**:

- [ ] å®šä¹‰å‰åç«¯æ¥å£ï¼ˆRESTfulé£æ ¼ï¼‰
- [ ] å…³é”®æ¥å£ç¤ºä¾‹:
  ```
  POST /api/reports              # åˆ›å»ºæŠ¥è¡¨
  GET  /api/reports/{id}         # æŸ¥è¯¢æŠ¥è¡¨å®šä¹‰
  POST /api/reports/test-execute # æµ‹è¯•æ‰§è¡Œ
  POST /api/reports/{id}/execute # æ‰§è¡ŒæŠ¥è¡¨
  GET  /api/reports/{id}/export  # å¯¼å‡ºExcel
  POST /api/permissions          # åˆ†é…æƒé™
  ```
- [ ] çº¦å®šæ•°æ®æ ¼å¼ï¼ˆJSON Schemaï¼‰
  ```json
  // æŠ¥è¡¨å®šä¹‰
  {
    "name": "é”€å”®æ—¥æŠ¥",
    "description": "...",
    "sqlTemplate": "SELECT ...",
    "params": [
      {"paramName": "startDate", "paramType": "DATE", ...}
    ],
    "columns": [
      {"fieldName": "date", "displayName": "æ—¥æœŸ", ...}
    ]
  }
  ```
- [ ] æ–‡æ¡£å·¥å…·: Swaggeræˆ–Markdown

**è´£ä»»äºº**: å¼€å‘A + å¼€å‘B
**å®Œæˆæ—¶é—´**: åŠå¤©
**äº§å‡º**: `API.md` æˆ– Swaggeré…ç½®
**éªŒæ”¶æ ‡å‡†**: å‰åç«¯å¯¹æ¥å£å®šä¹‰æ— å¼‚è®®

---

### 10.3 ç¬¬2-10å¤©è¡ŒåŠ¨ ğŸ“…

æŒ‰ç…§ç¬¬8ç« è¯¦ç»†æ’æœŸæ‰§è¡Œï¼š

- **æ¯æ—¥ç«™ä¼š**: 16:00ï¼Œ15åˆ†é’Ÿ
  - æ˜¨å¤©å®Œæˆäº†ä»€ä¹ˆï¼Ÿ
  - ä»Šå¤©è®¡åˆ’åšä»€ä¹ˆï¼Ÿ
  - æœ‰ä»€ä¹ˆé˜»å¡é—®é¢˜ï¼Ÿ
- **ç¬¬5å¤©ä¸­æœŸè¯„å®¡**: æ£€æŸ¥æ ¸å¿ƒåŠŸèƒ½å®Œæˆåº¦ï¼Œé£é™©è¯†åˆ«
- **ç¬¬8å¤©é›†æˆæµ‹è¯•**: å®Œæ•´æµç¨‹è·‘é€š
- **ç¬¬10å¤©æ¼”ç¤ºå‡†å¤‡**: å‡†å¤‡æ¼”ç¤ºæ•°æ®å’ŒPPT

---

### 10.4 é£é™©ç¼“è§£è¡ŒåŠ¨ âš ï¸

#### æ¯æ—¥é£é™©è¯†åˆ«

- æ¯æ—¥ç«™ä¼šæ—¶è¯†åˆ«é£é™©ï¼š
  - æŠ€æœ¯éš¾é¢˜ï¼ˆå¦‚SQLè§£æå¤æ‚ï¼‰
  - è¿›åº¦å»¶è¿Ÿï¼ˆå¦‚å‰ç«¯é¡µé¢æ¯”é¢„æœŸæ…¢ï¼‰
  - éœ€æ±‚å˜æ›´ï¼ˆå¦‚çªç„¶å¢åŠ æ–°éœ€æ±‚ï¼‰

#### åº”å¯¹ç­–ç•¥

1. **æŠ€æœ¯éš¾é¢˜**:

   - ä¸¤äººåä½œæ”»åš
   - æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£æˆ–ç¤¾åŒº
   - å¿…è¦æ—¶ç®€åŒ–æ–¹æ¡ˆ
2. **è¿›åº¦å»¶è¿Ÿ**:

   - åŠæ—¶è°ƒæ•´ä¼˜å…ˆçº§
   - ç æ‰éæ ¸å¿ƒåŠŸèƒ½
   - åŠ ç­æˆ–å»¶é•¿å·¥æœŸ
3. **éœ€æ±‚å˜æ›´**:

   - è¯„ä¼°å·¥ä½œé‡
   - è¦æ±‚å»¶æœŸæˆ–V2å®ç°
   - è®°å½•å˜æ›´æ—¥å¿—

---

### 10.5 éƒ¨ç½²å‡†å¤‡ï¼ˆDay 9-10ï¼‰ ğŸš€

#### éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©

**æ–¹æ¡ˆ1: å•æœºéƒ¨ç½²ï¼ˆæ¨èMVPï¼‰**

**æœåŠ¡å™¨é…ç½®**:

- CPU: 4æ ¸
- å†…å­˜: 8GB
- ç¡¬ç›˜: 100GB SSD
- æ“ä½œç³»ç»Ÿ: CentOS 7 / Ubuntu 20.04

**éƒ¨ç½²æ¶æ„**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nginx (80ç«¯å£)                        â”‚
â”‚  - å‰ç«¯é™æ€æ–‡ä»¶ (/var/www/report-tool) â”‚
â”‚  - åå‘ä»£ç†åç«¯ (proxy_pass :8080)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SpringBoot (8080ç«¯å£)                 â”‚
â”‚  - JARåŒ…: /opt/report-tool/app.jar     â”‚
â”‚  - systemdç®¡ç†è‡ªåŠ¨é‡å¯                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL (3306ç«¯å£)                      â”‚
â”‚  - æ•°æ®åº“: report_tool                  â”‚
â”‚  - è´¦å·: report_readonly (åªè¯»)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éƒ¨ç½²æ­¥éª¤**:

1. å®‰è£…ä¾èµ–: JDK 11ã€MySQLã€Nginx
2. åˆå§‹åŒ–æ•°æ®åº“: `mysql < schema.sql && mysql < data.sql`
3. é…ç½®SpringBoot: `application.yml`ï¼ˆæ•°æ®åº“è¿æ¥ã€ç«¯å£å·ï¼‰
4. æ‰“åŒ…åç«¯: `mvn clean package`
5. ä¸Šä¼ JARåŒ…: `scp target/report-tool.jar server:/opt/report-tool/`
6. å¯åŠ¨æœåŠ¡: `systemctl start report-tool`
7. ç¼–è¯‘å‰ç«¯: `npm run build`
8. ä¸Šä¼ å‰ç«¯: `scp -r dist/* server:/var/www/report-tool/`
9. é…ç½®Nginx: è§ä¸‹æ–¹é…ç½®ç¤ºä¾‹
10. é‡å¯Nginx: `systemctl restart nginx`

**Nginxé…ç½®**:

```nginx
server {
    listen 80;
    server_name report.example.com;
  
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/report-tool;
        try_files $uri $uri/ /index.html;
    }
  
    # åç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

---

#### è¿ç»´ç›‘æ§ï¼ˆMVPé˜¶æ®µï¼‰

**æ—¥å¿—ç®¡ç†**:

- SpringBootæ—¥å¿—: `/var/log/report-tool/app.log`
- æŒ‰æ—¥æœŸæ»šåŠ¨: `logback-spring.xml`é…ç½®

**è¿›ç¨‹ç›‘æ§**:

- systemdè‡ªåŠ¨é‡å¯: `Restart=always`

**æ•°æ®åº“å¤‡ä»½**:

```bash
# æ¯æ—¥å¤‡ä»½è„šæœ¬
0 2 * * * /usr/bin/mysqldump -u root -p'password' report_tool > /backup/report_tool_$(date +\%Y\%m\%d).sql
```

---

### 10.6 V2è§„åˆ’ï¼ˆ3-6ä¸ªæœˆåï¼‰ ğŸ”®

#### ä¼˜å…ˆçº§1ï¼ˆé«˜ä»·å€¼ï¼‰

1. **æŠ¥è¡¨åˆ†ç»„ä¸æ ‡ç­¾** (2äººæ—¥)
2. **å‚æ•°è”åŠ¨** (3äººæ—¥)
3. **æŠ¥è¡¨æ¨¡æ¿å¸‚åœº** (5äººæ—¥)

#### ä¼˜å…ˆçº§2ï¼ˆæ”¹å–„ä½“éªŒï¼‰

4. **å›¾è¡¨æ”¯æŒ** (5äººæ—¥)
5. **æŠ¥è¡¨æ ·å¼è‡ªå®šä¹‰** (3äººæ—¥)
6. **æ“ä½œå®¡è®¡çœ‹æ¿** (3äººæ—¥)

#### ä¼˜å…ˆçº§3ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰

7. **å®šæ—¶ä»»åŠ¡** (5äººæ—¥)
8. **å¤šæ•°æ®æºæ”¯æŒ** (5äººæ—¥)
9. **æŠ¥è¡¨ç‰ˆæœ¬ç®¡ç†** (3äººæ—¥)

#### æŠ€æœ¯å€ºåŠ¡å¿è¿˜

- æƒé™æ¨¡å‹é‡æ„ï¼ˆRBACï¼‰: 8äººæ—¥
- æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€è¿æ¥æ± ï¼‰: 5äººæ—¥
- å•å…ƒæµ‹è¯•è¡¥å……ï¼ˆè¦†ç›–ç‡60%ï¼‰: 8äººæ—¥

---

## 11. é™„å½•

### 11.1 å…³é”®ä»£ç ç¤ºä¾‹

#### A. SQLæ‰§è¡Œå¼•æ“æ ¸å¿ƒä»£ç 

```java
@Service
public class QueryExecutorService {
  
    @Autowired
    private DataSource dataSource;
  
    public QueryResult executeQuery(String sqlTemplate, Map<String, Object> params) 
            throws SQLException, SecurityException {
      
        // 1. SQLå®‰å…¨æ ¡éªŒ
        validateSql(sqlTemplate);
      
        // 2. å‚æ•°æ›¿æ¢ï¼ˆ#{paramName} -> ?ï¼‰
        ParseResult parseResult = parseSqlTemplate(sqlTemplate, params);
        String sql = parseResult.getSql();
        List<Object> paramValues = parseResult.getParamValues();
      
        // 3. æ‰§è¡ŒæŸ¥è¯¢
        try (Connection conn = dataSource.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
          
            // è®¾ç½®è¶…æ—¶
            ps.setQueryTimeout(5);
          
            // ç»‘å®šå‚æ•°
            for (int i = 0; i < paramValues.size(); i++) {
                ps.setObject(i + 1, paramValues.get(i));
            }
          
            // æ‰§è¡ŒæŸ¥è¯¢
            long startTime = System.currentTimeMillis();
            ResultSet rs = ps.executeQuery();
            long executionTime = System.currentTimeMillis() - startTime;
          
            // è½¬æ¢ç»“æœ
            QueryResult result = convertToQueryResult(rs);
            result.setExecutionTime(executionTime);
          
            return result;
        }
    }
  
    private void validateSql(String sql) throws SecurityException {
        String upperSql = sql.trim().toUpperCase();
      
        // åªå…è®¸SELECT
        if (!upperSql.startsWith("SELECT")) {
            throw new SecurityException("ä»…æ”¯æŒSELECTæŸ¥è¯¢");
        }
      
        // å…³é”®å­—é»‘åå•
        String[] dangerousKeywords = {
            "DROP", "DELETE", "TRUNCATE", "UPDATE", 
            "INSERT", "ALTER", "CREATE", "EXEC"
        };
      
        for (String keyword : dangerousKeywords) {
            if (upperSql.contains(keyword)) {
                throw new SecurityException("SQLåŒ…å«å±é™©å…³é”®å­—: " + keyword);
            }
        }
    }
  
    private ParseResult parseSqlTemplate(String sqlTemplate, Map<String, Object> params) {
        String sql = sqlTemplate;
        List<Object> paramValues = new ArrayList<>();
      
        Pattern pattern = Pattern.compile("#\\{(\\w+)\\}");
        Matcher matcher = pattern.matcher(sqlTemplate);
      
        while (matcher.find()) {
            String paramName = matcher.group(1);
            sql = sql.replaceFirst("#\\{" + paramName + "\\}", "?");
            paramValues.add(params.get(paramName));
        }
      
        return new ParseResult(sql, paramValues);
    }
  
    private QueryResult convertToQueryResult(ResultSet rs) throws SQLException {
        ResultSetMetaData meta = rs.getMetaData();
        int columnCount = meta.getColumnCount();
      
        // æå–åˆ—å…ƒæ•°æ®
        List<ColumnMeta> columns = new ArrayList<>();
        for (int i = 1; i <= columnCount; i++) {
            columns.add(new ColumnMeta(
                meta.getColumnName(i),
                meta.getColumnTypeName(i),
                meta.getColumnLabel(i)
            ));
        }
      
        // æå–æ•°æ®è¡Œ
        List<Map<String, Object>> rows = new ArrayList<>();
        while (rs.next()) {
            Map<String, Object> row = new LinkedHashMap<>();
            for (ColumnMeta col : columns) {
                row.put(col.getName(), rs.getObject(col.getName()));
            }
            rows.add(row);
        }
      
        return new QueryResult(columns, rows);
    }
}
```

---

#### B. Excelå¯¼å‡ºæ ¸å¿ƒä»£ç 

```java
@Service
public class ExportService {
  
    public byte[] exportToExcel(List<Map<String, Object>> data, 
                                 List<ReportColumn> columns) throws IOException {
      
        // é™åˆ¶è¡Œæ•°
        if (data.size() > 5000) {
            throw new BusinessException("æ•°æ®é‡è¿‡å¤§ï¼ˆ" + data.size() 
                + "è¡Œï¼‰ï¼Œè¯·æ·»åŠ ç­›é€‰æ¡ä»¶ï¼ˆé™åˆ¶: 5000è¡Œï¼‰");
        }
      
        Workbook workbook = new XSSFWorkbook();
        Sheet sheet = workbook.createSheet("æ•°æ®");
      
        // åˆ›å»ºè¡¨å¤´æ ·å¼
        CellStyle headerStyle = createHeaderStyle(workbook);
      
        // åˆ›å»ºè¡¨å¤´
        Row headerRow = sheet.createRow(0);
        for (int i = 0; i < columns.size(); i++) {
            Cell cell = headerRow.createCell(i);
            cell.setCellValue(columns.get(i).getDisplayName());
            cell.setCellStyle(headerStyle);
        }
      
        // å¡«å……æ•°æ®
        for (int i = 0; i < data.size(); i++) {
            Row row = sheet.createRow(i + 1);
            Map<String, Object> rowData = data.get(i);
          
            for (int j = 0; j < columns.size(); j++) {
                String fieldName = columns.get(j).getFieldName();
                Object value = rowData.get(fieldName);
              
                Cell cell = row.createCell(j);
                setCellValue(cell, value, columns.get(j).getDataFormat());
            }
        }
      
        // è‡ªåŠ¨åˆ—å®½
        for (int i = 0; i < columns.size(); i++) {
            sheet.autoSizeColumn(i);
        }
      
        // è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        workbook.write(bos);
        workbook.close();
      
        return bos.toByteArray();
    }
  
    private CellStyle createHeaderStyle(Workbook workbook) {
        CellStyle style = workbook.createCellStyle();
      
        // å­—ä½“åŠ ç²—
        Font font = workbook.createFont();
        font.setBold(true);
        style.setFont(font);
      
        // ç°è‰²èƒŒæ™¯
        style.setFillForegroundColor(IndexedColors.GREY_25_PERCENT.getIndex());
        style.setFillPattern(FillPatternType.SOLID_FOREGROUND);
      
        // è¾¹æ¡†
        style.setBorderBottom(BorderStyle.THIN);
        style.setBorderTop(BorderStyle.THIN);
        style.setBorderLeft(BorderStyle.THIN);
        style.setBorderRight(BorderStyle.THIN);
      
        return style;
    }
  
    private void setCellValue(Cell cell, Object value, String dataFormat) {
        if (value == null) {
            cell.setCellValue("");
            return;
        }
      
        if (value instanceof Number) {
            cell.setCellValue(((Number) value).doubleValue());
        } else if (value instanceof Date) {
            cell.setCellValue((Date) value);
            // åº”ç”¨æ—¥æœŸæ ¼å¼
            if ("date".equals(dataFormat)) {
                CellStyle style = cell.getSheet().getWorkbook().createCellStyle();
                style.setDataFormat((short) 14); // yyyy-MM-dd
                cell.setCellStyle(style);
            }
        } else {
            cell.setCellValue(String.valueOf(value));
        }
    }
}
```

---

#### C. RBACæƒé™æœåŠ¡æ ¸å¿ƒä»£ç 

```java
@Service
public class PermissionService {
  
    @Autowired
    private UserRoleRepository userRoleRepository;
  
    @Autowired
    private ReportRolePermissionRepository reportRolePermissionRepository;
  
    @Autowired
    private ReportRepository reportRepository;
  
    /**
     * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®æŠ¥è¡¨
     * @param userId ç”¨æˆ·ID
     * @param reportId æŠ¥è¡¨ID
     * @return true=æœ‰æƒé™, false=æ— æƒé™
     */
    @Cacheable(value = "userReportPermission", key = "#userId + '_' + #reportId")
    public boolean hasPermission(Long userId, Long reportId) {
        // 1. è·å–ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²ID
        List<Long> userRoleIds = userRoleRepository.findRoleIdsByUserId(userId);
      
        if (userRoleIds.isEmpty()) {
            return false;
        }
      
        // 2. æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜ï¼ˆç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰æŠ¥è¡¨ï¼‰
        if (hasRole(userId, "ADMIN")) {
            return true;
        }
      
        // 3. æ£€æŸ¥ç”¨æˆ·çš„è§’è‰²æ˜¯å¦æœ‰æŠ¥è¡¨æƒé™
        return reportRolePermissionRepository.existsByReportIdAndRoleIdIn(
            reportId, userRoleIds
        );
    }
  
    /**
     * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šè§’è‰²
     */
    @Cacheable(value = "userRoles", key = "#userId")
    public boolean hasRole(Long userId, String roleCode) {
        return userRoleRepository.existsByUserIdAndRoleCode(userId, roleCode);
    }
  
    /**
     * è·å–ç”¨æˆ·å¯è®¿é—®çš„æ‰€æœ‰æŠ¥è¡¨ID
     */
    public List<Long> getAccessibleReportIds(Long userId) {
        // ç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰æŠ¥è¡¨
        if (hasRole(userId, "ADMIN")) {
            return reportRepository.findAllReportIds();
        }
      
        // è·å–ç”¨æˆ·è§’è‰²çš„æ‰€æœ‰æŠ¥è¡¨æƒé™
        List<Long> userRoleIds = userRoleRepository.findRoleIdsByUserId(userId);
        return reportRolePermissionRepository.findReportIdsByRoleIdIn(userRoleIds);
    }
  
    /**
     * è·å–æŠ¥è¡¨æˆæƒçš„è§’è‰²åˆ—è¡¨
     */
    public List<Role> getReportRoles(Long reportId) {
        return reportRolePermissionRepository.findRolesByReportId(reportId);
    }
  
    /**
     * ä¸ºæŠ¥è¡¨åˆ†é…è§’è‰²æƒé™
     */
    @Transactional
    @CacheEvict(value = "userReportPermission", allEntries = true)
    public void assignRoleToReport(Long reportId, Long roleId) {
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        if (!reportRolePermissionRepository.existsByReportIdAndRoleId(reportId, roleId)) {
            ReportRolePermission permission = new ReportRolePermission();
            permission.setReportId(reportId);
            permission.setRoleId(roleId);
            reportRolePermissionRepository.save(permission);
        }
    }
  
    /**
     * å–æ¶ˆæŠ¥è¡¨çš„è§’è‰²æƒé™
     */
    @Transactional
    @CacheEvict(value = "userReportPermission", allEntries = true)
    public void removeRoleFromReport(Long reportId, Long roleId) {
        reportRolePermissionRepository.deleteByReportIdAndRoleId(reportId, roleId);
    }
}
```

---

#### D. RBACæƒé™æ‹¦æˆªå™¨ä»£ç 

```java
@Component
public class PermissionInterceptor implements HandlerInterceptor {
  
    @Autowired
    private PermissionService permissionService;
  
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) throws Exception {
      
        // æå–æŠ¥è¡¨ID
        String uri = request.getRequestURI();
        Pattern pattern = Pattern.compile("/api/reports/(\\d+)/(execute|export)");
        Matcher matcher = pattern.matcher(uri);
      
        if (matcher.find()) {
            Long reportId = Long.parseLong(matcher.group(1));
          
            // è·å–å½“å‰ç”¨æˆ·ID
            Long userId = getCurrentUserId(request);
          
            if (userId == null) {
                response.setStatus(401);
                response.setContentType("application/json;charset=UTF-8");
                response.getWriter().write("{\"error\":\"æœªç™»å½•\"}");
                return false;
            }
          
            // æ ¡éªŒRBACæƒé™
            if (!permissionService.hasPermission(userId, reportId)) {
                response.setStatus(403);
                response.setContentType("application/json;charset=UTF-8");
                response.getWriter().write("{\"error\":\"æ— æƒé™è®¿é—®æ­¤æŠ¥è¡¨\"}");
                return false;
            }
        }
      
        return true;
    }
  
    private Long getCurrentUserId(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session != null) {
            User user = (User) session.getAttribute("currentUser");
            return user != null ? user.getId() : null;
        }
        return null;
    }
}
```

---

### 11.2 æŠ€æœ¯é€‰å‹å¯¹æ¯”

#### å‰ç«¯æ¡†æ¶é€‰æ‹©

| æ¡†æ¶    | ä¼˜åŠ¿                               | åŠ£åŠ¿                    | ç»“è®º       |
| ------- | ---------------------------------- | ----------------------- | ---------- |
| Vue 2.x | å›¢é˜Ÿç†Ÿæ‚‰ï¼Œç”Ÿæ€æˆç†Ÿï¼ŒElement UIå®Œå–„ | Vue 3å·²å‘å¸ƒï¼Œå­˜åœ¨æŠ€æœ¯å€º | âœ… æ¨èMVP |
| Vue 3.x | æ€§èƒ½æ›´å¥½ï¼ŒComposition API          | å›¢é˜Ÿä¸ç†Ÿæ‚‰ï¼Œå­¦ä¹ æˆæœ¬é«˜  | âŒ V2è€ƒè™‘  |
| React   | ç¤¾åŒºæœ€å¤§ï¼Œç»„ä»¶ä¸°å¯Œ                 | å›¢é˜Ÿä¸ç†Ÿæ‚‰ï¼Œä¸Šæ‰‹æ…¢      | âŒ ä¸é€‚åˆ  |

---

#### Excelå¯¼å‡ºåº“é€‰æ‹©

| åº“         | ä¼˜åŠ¿               | åŠ£åŠ¿                     | ç»“è®º       |
| ---------- | ------------------ | ------------------------ | ---------- |
| Apache POI | åŠŸèƒ½å®Œæ•´ï¼Œç¤¾åŒºæ´»è·ƒ | å¤§æ•°æ®é‡æ€§èƒ½å·®ï¼ˆ>5ä¸‡è¡Œï¼‰ | âœ… æ¨èMVP |
| EasyExcel  | æ€§èƒ½å¥½ï¼Œå†…å­˜å ç”¨ä½ | åŠŸèƒ½è¾ƒPOIç®€å•            | â° V2å‡çº§  |
| JXL        | è½»é‡               | ä¸æ”¯æŒxlsxï¼Œå·²åœæ­¢ç»´æŠ¤   | âŒ ä¸æ¨è  |

---

#### SQLç¼–è¾‘å™¨é€‰æ‹©

| ç¼–è¾‘å™¨     | ä¼˜åŠ¿                  | åŠ£åŠ¿                   | ç»“è®º       |
| ---------- | --------------------- | ---------------------- | ---------- |
| CodeMirror | è½»é‡ï¼ŒSQLè¯­æ³•é«˜äº®     | æ— æ™ºèƒ½æç¤º             | âœ… æ¨èMVP |
| Monaco     | VS Codeå†…æ ¸ï¼ŒåŠŸèƒ½å¼ºå¤§ | ä½“ç§¯å¤§ï¼ˆ2MB+ï¼‰         | â° V2è€ƒè™‘  |
| Ace Editor | è½»é‡ï¼Œå¤šè¯­è¨€æ”¯æŒ      | ç¤¾åŒºä¸å¦‚CodeMirroræ´»è·ƒ | âŒ ä¸æ¨è  |

---

### 11.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼ˆV2ï¼‰

#### æ•°æ®åº“ä¼˜åŒ–

1. **è¯»å†™åˆ†ç¦»**: æŠ¥è¡¨æŸ¥è¯¢èµ°ä»åº“
2. **è¿æ¥æ± è°ƒä¼˜**: Druidé…ç½®åˆç†å‚æ•°
3. **æ…¢æŸ¥è¯¢ç›‘æ§**: å¼€å¯MySQLæ…¢æŸ¥è¯¢æ—¥å¿—

#### ç¼“å­˜ä¼˜åŒ–

1. **æŸ¥è¯¢ç»“æœç¼“å­˜**: Redisç¼“å­˜ç›¸åŒå‚æ•°çš„æŸ¥è¯¢ç»“æœï¼ˆTTL: 5åˆ†é’Ÿï¼‰
2. **æŠ¥è¡¨å®šä¹‰ç¼“å­˜**: ç¼“å­˜æŠ¥è¡¨é…ç½®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢

#### å‰ç«¯ä¼˜åŒ–

1. **è™šæ‹Ÿæ»šåŠ¨**: å¤§æ•°æ®é‡è¡¨æ ¼ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
2. **æ‡’åŠ è½½**: æŠ¥è¡¨åˆ—è¡¨åˆ†é¡µåŠ è½½
3. **CDNåŠ é€Ÿ**: é™æ€èµ„æºä½¿ç”¨CDN

---

### 11.4 å®‰å…¨åŠ å›ºå»ºè®®ï¼ˆV2ï¼‰

1. **HTTPSåŠ å¯†**: éƒ¨ç½²SSLè¯ä¹¦
2. **JWT Token**: æ›¿æ¢Sessionè®¤è¯
3. **CSRFé˜²æŠ¤**: æ·»åŠ CSRF Token
4. **SQLè§£æå™¨**: ä½¿ç”¨JSqlParseræ·±åº¦æ ¡éªŒSQL
5. **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œï¼ˆåˆ›å»º/åˆ é™¤æŠ¥è¡¨ã€æˆæƒï¼‰
6. **IPç™½åå•**: é™åˆ¶ç®¡ç†ç«¯è®¿é—®IP
7. **å¯†ç åŠ å¯†**: BCryptåŠ å¯†ç”¨æˆ·å¯†ç 
8. **XSSé˜²æŠ¤**: å‰ç«¯è¾“å…¥è¿‡æ»¤ï¼Œåç«¯è½¬ä¹‰

---

### 11.5 å¸¸è§é—®é¢˜FAQ

#### Q1: ä¸ºä»€ä¹ˆä¸æ”¯æŒå›¾è¡¨ï¼Ÿ

A: MVPèšç„¦æ ¸å¿ƒåŠŸèƒ½ï¼Œå›¾è¡¨å±äºå¢å¼ºä½“éªŒï¼ŒV2é›†æˆEChartsã€‚

#### Q2: ä¸ºä»€ä¹ˆé™åˆ¶å¯¼å‡º5000è¡Œï¼Ÿ

A: å¤§æ•°æ®é‡å¯¼å‡ºä¼šå¯¼è‡´å†…å­˜æº¢å‡ºå’Œè¶…æ—¶ï¼ŒV2æ”¯æŒå¼‚æ­¥å¯¼å‡ºã€‚

#### Q3: ä¸ºä»€ä¹ˆæƒé™æ¨¡å‹è¿™ä¹ˆç®€å•ï¼Ÿ

A: 2å‘¨æ—¶é—´ç´§ï¼Œå¤æ‚æƒé™ï¼ˆè§’è‰²/ç»„ç»‡æ¶æ„ï¼‰å¼€å‘+æµ‹è¯•éœ€è¦5äººæ—¥ï¼ŒV2é‡æ„ã€‚

#### Q4: å¦‚ä½•ä¿è¯SQLå®‰å…¨ï¼Ÿ

A: ä¸‰é‡é˜²æŠ¤ï¼šç™½åå•æ ¡éªŒ+åªè¯»è´¦å·+è¶…æ—¶æ§åˆ¶ã€‚

#### Q5: èƒ½å¦æ”¯æŒå¤šæ•°æ®æºï¼Ÿ

A: MVPåªæ”¯æŒå•æ•°æ®æºï¼ŒV2æ”¯æŒé…ç½®å¤šä¸ªæ•°æ®æºã€‚

---

## ğŸ“ æ–‡æ¡£å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ       | å˜æ›´å†…å®¹               | ä½œè€… |
| ---- | ---------- | ---------------------- | ---- |
| v1.0 | 2025-12-26 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´ç³»ç»Ÿåˆ†æ | AI   |

---

## ğŸ æ€»ç»“

æœ¬æŠ¥å‘Šé€šè¿‡Sequential Thinkingç³»ç»Ÿåˆ†ææ–¹æ³•ï¼Œå¯¹"ç¨‹åºå‘˜æŠ¥è¡¨ç”Ÿæˆå·¥å…·"è¿›è¡Œäº†å…¨é¢è¯„ä¼°ï¼š

### âœ… æ ¸å¿ƒç»“è®º

1. **å¯è¡Œæ€§**: 2å‘¨2äººå®ŒæˆMVPæ˜¯å¯è¡Œçš„ï¼Œä½†éœ€è¦å›¢é˜Ÿç†Ÿæ‚‰æŠ€æœ¯æ ˆï¼Œä¸”éœ€æ±‚ç¨³å®š
2. **å…³é”®é£é™©**: SQLå®‰å…¨ã€æ—¶é—´å‹åŠ›ã€æ€§èƒ½é—®é¢˜
3. **MVPèŒƒå›´**: 5ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œ16äººæ—¥å¼€å‘ + 4äººæ—¥Buffer
4. **æŠ€æœ¯æ ˆ**: SpringBoot + Vue + MySQL + Apache POI
5. **ä¸‹ä¸€æ­¥**: ç«‹å³æ‰§è¡Œ"10.1èŠ‚"çš„3ä¸ªè¡ŒåŠ¨ï¼Œå¯åŠ¨é¡¹ç›®

### ğŸ“Š é¡¹ç›®æˆåŠŸè¦ç´ 

- â­ å›¢é˜ŸæŠ€èƒ½: ç†Ÿæ‚‰SpringBootå’ŒVue
- â­ èŒƒå›´æ§åˆ¶: æœæ–­ç æ‰éæ ¸å¿ƒåŠŸèƒ½
- â­ æ¯æ—¥ç«™ä¼š: ç´§å¯†åŒæ­¥è¿›åº¦
- â­ å®‰å…¨ç¬¬ä¸€: SQLç™½åå•+åªè¯»è´¦å·
- â­ è´¨é‡æŠŠæ§: å…³é”®æ¨¡å—å•å…ƒæµ‹è¯•

### ğŸ¯ å»ºè®®

- å¦‚å›¢é˜Ÿç»éªŒä¸è¶³ï¼Œå»¶é•¿åˆ°3å‘¨æ›´å®‰å…¨
- MVPéªŒè¯éœ€æ±‚åï¼ŒV2æŠ•å…¥æ›´å¤šèµ„æºä¼˜åŒ–
- å®šæœŸå¤ç›˜ï¼ŒæŒç»­æ”¹è¿›æµç¨‹

---

**ç¥é¡¹ç›®é¡ºåˆ©ï¼** ğŸš€
